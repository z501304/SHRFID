C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE EQUIPMENT
OBJECT MODULE PLACED IN equipment.OBJ
COMPILER INVOKED BY: D:\Keil5\Keil5_C51\C51\BIN\C51.EXE equipment.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          //---------------------------------------------------------------------
   2          //   PROG : 
   3          //   DATE : 2014.2
   4          //   COMP : sh-rfid
   5          //   DESP : all file list
   6          //---------------------------------------------------------------------
   7          #include "include.h"
   8          
   9          #define  ReaderSignalON     0x02
  10          #define  ReaderSignalOFF    0x00
  11          #define  BoxSignalON      0x01
  12          #define  BoxSignalOFF     0x00
  13          //¸´Î»ÃüÁî·´À¡
  14          code char Re_reset[]    = {0x82,0x08,0x21,0x00,0x00,0x00,0x00,0x00,0xA6,0xE3,0x83};  
  15          //ÈëÊéÃüÁî·´À¡ 
  16          code char Re_book_in[]    = {0x82,0x08,0x22,0x00,0x01,0x01,0x00,0x00,0xBC,0xA9,0x83}; 
  17          //ÍËÊéÃüÁî·´À¡ 
  18          code char Re_book_out[]   = {0x82,0x08,0x22,0x00,0x01,0x02,0x00,0x00,0xD8,0x46,0x83};
  19          //ÈëÏäÃüÁî·´À¡  
  20          code char Re_book_drop[]    = {0x82,0x08,0x22,0x00,0x02,0x01,0x00,0x00,0x71,0x8C,0x83};
  21          //½áÊøÃüÁî
  22          code char Re_close_drop[]   = {0x82,0x08,0x22,0x00,0x02,0x02,0x00,0x00,0x15,0x63,0x83}; 
  23          //¹Ì¼þ°æ±¾²éÑ¯·µ»Ø
  24          //code char Re_check_vison[]  = {0x82,0x08,0x40,0x00,version_H,version_L,0x00,0x00,0xDE,0xAB,0x83};// //1.
             -1
  25          //´«ËÍ´øÕÅ×ª
  26          code char Re_prog_direct[]  = {0x82,0x08,0x22,0x00,0x03,0x01,0x00,0x00,0x71,0x8C,0x83};
  27          //´«ËÍ´ø·´×ª
  28          code char Re_prog_reverse[] = {0x82,0x08,0x22,0x00,0x03,0x02,0x00,0x00,0x71,0x8C,0x83};
  29          //´«ËÍ´øÍ£Ö¹
  30          code char Re_prog_stop[]    = {0x82,0x08,0x22,0x00,0x03,0x03,0x00,0x00,0x71,0x8C,0x83};
  31          
  32          //Ö÷¶¯ÉÏ±¨·µ»Ø
  33          code char init_report_s0[]    = {0x82,0x08,0x23,0x00,0x00,0x00,0x00,0x00,0x4B,0xf7,0x83};   //È«²¿Çå³ý
  34          code char init_report_s1[]    = {0x82,0x08,0x23,0x00,0x01,0x00,0x00,0x00,0x4B,0xf7,0x83};   //1ºÅ¹âÄ»±»ÕÚµ²
  35          code char init_report_s2[]    = {0x82,0x08,0x23,0x00,0x02,0x00,0x00,0x00,0x86,0xD2,0x83};   //2ºÅ¹âÄ»±»ÕÚµ²
  36          code char init_report_s3[]    = {0x82,0x08,0x23,0x00,0x03,0x00,0x00,0x00,0x3D,0xCE,0x83};   //3ºÅ¹âÄ»±»ÕÚµ²
  37          code char init_report_s4[]    = {0x82,0x08,0x23,0x00,0x04,0x00,0x00,0x00,0x1C,0x99,0x83};   //4ºÅ¹âÄ»±»ÕÚµ²
  38          code char init_report_s5[]    = {0x82,0x08,0x23,0x00,0x05,0x00,0x00,0x00,0xA7,0x85,0x83};   //1ºÅ¹âÄ»±»Çå³ý
  39          code char init_report_s6[]    = {0x82,0x08,0x23,0x00,0x06,0x00,0x00,0x00,0x6A,0xA0,0x83};   //2ºÅ¹âÄ»±»Çå³ý
  40          code char init_report_s7[]    = {0x82,0x08,0x23,0x00,0x07,0x00,0x00,0x00,0xD1,0xBC,0x83};   //3ºÅ¹âÄ»±»Çå³ý
  41          code char init_report_s8[]    = {0x82,0x08,0x23,0x00,0x08,0x00,0x00,0x00,0x28,0x0E,0x83};   //4ºÅ¹âÄ»±»Çå³ý
  42          code char init_report_s9[]    = {0x82,0x08,0x23,0x00,0x09,0x00,0x00,0x00,0x93,0x12,0x83};   //¿ªÃÅµ½Î»
  43          code char init_report_s10[]   = {0x82,0x08,0x23,0x00,0x0a,0x00,0x00,0x00,0x5E,0x37,0x83};   //¿ªÃÅ³¬Ê±
  44          code char init_report_s11[]   = {0x82,0x08,0x23,0x00,0x0b,0x00,0x00,0x00,0xE5,0x2B,0x83};   //¹ØÃÅµ½Î»
  45          code char init_report_s12[]   = {0x82,0x08,0x23,0x00,0x0c,0x00,0x00,0x00,0xC4,0x7C,0x83};   //¹ØÃÅ³¬Ê±
  46          code char init_report_s13[]   = {0x82,0x08,0x23,0x00,0x0d,0x00,0x00,0x00,0xA3,0x3A,0x83};  
  47          code char init_report_s14[]   = {0x82,0x08,0x23,0x00,0x0e,0x00,0x00,0x00,0x0A,0xF0,0x83};
  48          code char init_report_s15[]   = {0x82,0x08,0x23,0x00,0x0f,0x00,0x00,0x00,0x09,0x59,0x83};
  49          code char init_report_s17[]   = {0x82,0x08,0x23,0x00,0x11,0x01,0x00,0x00,0xA3,0x3A,0x83};  //´«ËÍ´øÕý×ª
  50          code char init_report_s18[]   = {0x82,0x08,0x23,0x00,0x11,0x02,0x00,0x00,0x0A,0xF0,0x83};  //´«ËÍ´ø·´×ª
  51          code char init_report_s19[]   = {0x82,0x08,0x23,0x00,0x11,0x03,0x00,0x00,0x09,0x59,0x83};  //´«ËÍ´øÍ£Ö¹
  52          code char init_report_s20[]   = {0x82,0x08,0x23,0x00,0x12,0x00,0x00,0x00,0x00,0x00,0x83};  //Í¼Êé³¬³¤
  53          code char init_report_s21[]   = {0x82,0x08,0x23,0x00,0x13,0x00,0x00,0x00,0x00,0x00,0x83};  //»¹Êé¿ÚÓÐÒìÎï
  54          code char init_report_s30[]   = {0x82,0x08,0x23,0x00,0xee,0x00,0x00,0x00,0x00,0x00,0x83};  //´«¸ÐÆ÷×´Ì¬²»Ã÷
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 2   

  55          
  56          code char init_report_s121[]  = {0x82,0x08,0x23,0x00,0x0c,0x01,0x00,0x00,0xC4,0x7C,0x83};  //½áÊø·ÅÊé 
  57          
  58          code char init_report_s131[]  = {0x82,0x08,0x23,0x00,0x0d,0x01,0x00,0x00,0xA3,0x3A,0x83};  // ÈëÊé³É¹¦
  59          code char init_report_s132[]  = {0x82,0x08,0x23,0x00,0x0d,0x02,0x00,0x00,0xC7,0xD5,0x83};  // ÈëÊéÊ§°Ü
  60          code char init_report_s133[]  = {0x82,0x08,0x23,0x00,0x0d,0x03,0x00,0x00,0xC7,0xD5,0x83};  // ÈëÊé³¬Ê±
  61          code char init_report_s141[]  = {0x82,0x08,0x23,0x00,0x0e,0x01,0x00,0x00,0x6E,0x1F,0x83};  // ÈëÏä³É¹¦
  62          code char init_report_s142[]  = {0x82,0x08,0x23,0x00,0x0e,0x02,0x00,0x00,0x0A,0xF0,0x83};  // ÈëÏäÊ§°Ü
  63          code char init_report_s151[]  = {0x82,0x08,0x23,0x00,0x0f,0x01,0x00,0x00,0x09,0x59,0x83};  // ÍËÊé³É¹¦
  64          code char init_report_s152[]  = {0x82,0x08,0x23,0x00,0x0f,0x02,0x00,0x00,0x51,0x28,0x83};  // ÍËÊéÊ§°Ü
  65          code char init_report_s16[]   = {0X82,0X08,0X23,0X00,0X10,0X00,0X00,0X00,0x00,0x00,0X83};  // ¸´Î»³É¹¦
  66          //×´Ì¬²éÑ¯·µ»Ø
  67          code char Re_che_state[]    = {0x82,0x08,0x24,0x00,0x00,0x00,0x00,0x00,0x21,0xf7,0x83};
  68          code char Re_state_ok[]     = {0x82,0x08,0x24,0x00,0x00,0x01,0x00,0x00,0x1f,0x66,0x83};
  69          /*code char Re_s1_erro[]      = {0x82,0x08,0x24,0x00,0x01,0x00,0x00,0x00,0x9a,0xeb,0x83};
  70          code char Re_s2_erro[]      = {0x82,0x08,0x24,0x00,0x02,0x00,0x00,0x00,0xb5,0x05,0x83};
  71          code char Re_s3_erro[]      = {0x82,0x08,0x24,0x00,0x03,0x00,0x00,0x00,0x0e,0xe9,0x83};
  72          code char Re_s4_erro[]      = {0x82,0x08,0x24,0x00,0x04,0x00,0x00,0x00,0x2f,0x4e,0x83};
  73          code char Re_s5_erro[]      = {0x82,0x08,0x24,0x00,0x05,0x00,0x00,0x00,0x94,0x52,0x83};
  74          code char Re_s6_erro[]      = {0x82,0x08,0x24,0x00,0x06,0x00,0x00,0x00,0x59,0x77,0x83};
  75          code char Re_s7_erro[]      = {0x82,0x08,0x24,0x00,0x07,0x00,0x00,0x00,0xe2,0x6b,0x83};
  76          code char Re_s8_erro[]      = {0x82,0x08,0x24,0x00,0x08,0x00,0x00,0x00,0x1b,0xd9,0x83};
  77          code char Re_s9_erro[]      = {0x82,0x08,0x24,0x00,0x09,0x00,0x00,0x00,0xa0,0xc5,0x83};
  78          code char Re_s10_erro[]     = {0x82,0x08,0x24,0x00,0x0a,0x00,0x00,0x00,0x6d,0xe0,0x83};
  79          code char Re_s11_erro[]     = {0x82,0x08,0x24,0x00,0x0b,0x00,0x00,0x00,0xd6,0xfc,0x83};
  80          code char Re_s12_erro[]     = {0x82,0x08,0x24,0x00,0x0c,0x00,0x00,0x00,0xf7,0xab,0x83};
  81          code char Re_s13_erro[]     = {0x82,0x08,0x24,0x00,0x0d,0x00,0x00,0x00,0x4c,0xb7,0x83};
  82          code char Re_s14_erro[]     = {0x82,0x08,0x24,0x00,0x0e,0x00,0x00,0x00,0x81,0x92,0x83};
  83          code char Re_s15_erro[]     = {0x82,0x08,0x24,0x00,0x0f,0x00,0x00,0x00,0x3a,0x8e,0x83};
  84          code char Re_s16_erro[]     = {0x82,0x08,0x24,0x00,0x10,0x00,0x00,0x00,0x62,0xff,0x83}; */
  85          
  86          unsigned char Re_data_erro[]    = {0x82,0x08,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x83};
  87          
  88          unsigned char bdata SystemFlag;
  89          sbit SysState = SystemFlag^0;
  90          sbit sys_timeout_flag = SystemFlag^1;
  91          sbit SafeFlag = SystemFlag^2;
  92          
  93          void prog_direct_running()                                 //Õý×ª
  94          {
  95   1        doorlock_c1 = control_off;
  96   1        doorlock_c2 = control_on;
  97   1      }
  98          void prog_Reverse_running()                         //·´×ª
  99          {
 100   1        doorlock_c1 = control_on;
 101   1        doorlock_c2 = control_off;
 102   1      }
 103          void prog_stop_running()                               //Í£Ö¹
 104          { 
 105   1        doorlock_c1 = control_off;
 106   1        doorlock_c2 = control_off;
 107   1        delay_1msx(100);
 108   1      //  book_stop_running_250tims = 2;
 109   1      //  while(book_stop_running_250tims) ;                     //Í£Ö¹ºó£¬ÔÝÍ£500ms£¬±ÜÃâ³öÏÖµã»÷Õý·´×°£¬ÔÝÍ£Ö®¼äÇÐ»»¹ý¿ì
             -ÎÊÌâËðÉËµç»ú
 110   1      }
 111          /*void Light_red_on()                                 //ºìÉ«Ö¸Ê¾µÆÁÁ£¬ÂÌÉ«Ö¸Ê¾µÆÃð
 112          {
 113            light_red     = control_on;
 114            light_green = control_off;
 115          }
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 3   

 116          
 117          void Light_green_on()                         //ÂÌÉ«Ö¸Ê¾µÆÁÁ£¬ºìÉ«Ö¸Ê¾µÆÃð
 118          {
 119            light_red     = control_off;
 120            light_green = control_on;
 121          }
 122          
 123          void Light_off()                              //ºìÉ«ÂÌÉ«Ö¸Ê¾µÆ¶¼Ãð
 124          {
 125            light_red     = control_off;
 126            light_green = control_off;
 127          }*/
 128          
 129          void Positive_Door_run()      //¿ªÃÅ
 130          {
 131   1      //    delay(800);                 //2012.11.28
 132   1          GND_1 = 0;
 133   1          V12_1 = 0;
 134   1          GND_2 = 1;
 135   1          V12_2 = 1;
 136   1      
 137   1      }
 138          
 139          void Negative_Door_run()       //¹ØÃÅ
 140          {
 141   1          GND_1 = 1;
 142   1          V12_1 = 1;
 143   1          GND_2 = 0;
 144   1          V12_2 = 0;
 145   1      }
 146          
 147          void Stop_Door_run()
 148          {
 149   1          GND_1 = 1;
 150   1          V12_1 = 1;
 151   1          GND_2 = 1;
 152   1          V12_2 = 1;
 153   1      }
 154            
 155          ////////////////////////////////////////////////////////////////////////
 156          //Ãû³Æ£ºuint CRC3(unsigned char *ptr, uchar  i_len)
 157          //¹¦ÄÜ£º¼ÆËãÖ¸¶¨Êý¾ÝÑ­»·ÈßÓàÐ£ÑéÂë
 158          //Èë¿Ú²ÎÊý£ºptr     Ö¸¶¨Êý¾Ý¿éÊ×µØÖ·
 159          //          i_len   Ö¸¶¨Êý¾Ý¿é³¤¶È
 160          //³ö¿Ú²ÎÊý£ºcrc     Ö¸¶¨Êý¾ÝµÄÐ£ÑéÂë
 161          //ÏµÍ³Ó°Ïì£ºÎÞ
 162          ///////////////////////////////////////////////////////////////////////
 163          uint CRC3(unsigned char *ptr, uchar  i_len)
 164          {
 165   1        uint CRC_POLYNOM = 0x8408;                        //polynome [Êý]¶àÏîÊ½(µÄ)
 166   1        uint CRC_PRESET  = 0xFFFF;
 167   1        uint crc = CRC_PRESET;
 168   1        uchar i,j;
 169   1        for(i=0;i< i_len;i++)
 170   1        {
 171   2          crc^=*ptr;                                          // ^ Òì»ò²Ù×÷ crc = crc ^ (*ptr) = 0xFFFF ^(*ptr)
 172   2          ptr++;
 173   2          for(j=0;j< 8; j++)
 174   2          {
 175   3            if((crc&0x0001)>0)
 176   3              crc = (crc>>1)^CRC_POLYNOM;
 177   3            else
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 4   

 178   3              crc = (crc>>1);
 179   3          }             
 180   2        }
 181   1        return (crc);
 182   1      }
 183                                                //²ÉÓÃÊ±¼äÆ¬·½Ê½Ä£Äâ¶àÏß³Ì´¦Àí£¬
 184                                              //¿ÉÒÔÔÚ±ÜÃâÖ´ÐÐÊ±¼ä½Ï³¤µÄÃüÁî¶¯×÷ÆÚ¼äÏàÓ¦ÏµÍ³ÃüÁî£¬¿ÉÒÔ±ÜÃâÉÏÎ»»ú´ô»ú
 185          void SystermProcess(void)
 186          {
 187   1          uchar flag = 0;
 188   1          switch(CURRENT_FATHER_PROCESS)
 189   1        {
 190   2            #region ¸´Î»²Ù×÷
*** WARNING C315 IN LINE 190 OF equipment.c: unknown #directive 'region'
 191   2        
 192   2          case PROCESS_Command_reset :                  
 193   2            switch(CURRENT_SON_PROCESS)
 194   2            {
 195   3              case  PROCESS_Command_reset_Step0:
 196   3                  send_string_com(Re_reset);            //ÉÏ±¨¸´Î»ÃüÁî½ÓÊÕµ½
 197   3                  prog_direct_running();              //´«ËÍ´øÕý×ª
 198   3                  
 199   3                  //Positive_Door_run();              //¿ªÃÅ  £¬µç»úºÍÈë¿Ú´¦½Ó½ü¿ª¹ØÁ´½ÓÏà·´  £¬2013.5.7 £¬Ñîº£·å
 200   3                  prog_reset_250times = 4*4;            //µç»ú×ª¶¯Ê±¼ä5Ãë
 201   3                  door_running_250times = 4*4;          //¹ØÃÅÊ±¼ä½çÏÞ3Ãë
 202   3                  CURRENT_SON_PROCESS   = PROCESS_Command_reset_Step1;
 203   3                  SysModle = SystermBussy;
 204   3                  //break;
 205   3              case  PROCESS_Command_reset_Step1:
 206   3                         
 207   3      //            if((CloseStopDoorRun == 0)||(!door_running_250times))     //ÃÅµ½Î»Í£Ö¹9.22
 208   3      //            {
 209   3      //               Stop_Door_run();
 210   3      //            // send_string_com(init_report_s9);      //ÉÏ±¨¿ªÃÅµ½Î»
 211   3      //            }
 212   3      
 213   3                  if(prog_reset_250times<8)  
 214   3                  {           
 215   4                    prog_Reverse_running();
 216   4                    if(prog_reset_250times==0)
 217   4                    { 
 218   5                      prog_stop_running();
 219   5                      prog_reset_250times = 4*3;  
 220   5                      door_NErunning_250times = 4*5;
 221   5                      //Negative_Door_run();
 222   5                      CURRENT_SON_PROCESS = PROCESS_Command_reset_Step2;
 223   5                    }                 
 224   4                  } 
 225   3                  
 226   3                  break;
 227   3              case  PROCESS_Command_reset_Step2:
 228   3                  //Negative_Door_run();                                                                 //¿ªÃÅÊ±¼ä½çÏÞ5Ãë
 229   3      //            while((OpenStopDoorRun == 0))//||(!door_NErunning_250times))         //ÃÅµ½Î»Í£Ö¹9.22
 230   3      //              {
 231   3      //                 Stop_Door_run();
 232   3      //              // send_string_com(init_report_s11);               //ÉÏ±¨¹ØÃÅµ½Î»
 233   3      //               send_string_com(init_report_s16);             //ÉÏ±¨¸´Î»Íê±Ï£¬Éè±¸´¦ÓÚ¿ÕÏÐ×´Ì¬
 234   3      //               CURRENT_SON_PROCESS = PROCESS_Command_reset_Step3;
 235   3      //               SysModle = SystermIdle;
 236   3      //               break;
 237   3      //            }
 238   3                    send_string_com(init_report_s16);            //ÉÏ±¨¸´Î»Íê±Ï£¬Éè±¸´¦ÓÚ¿ÕÏÐ×´Ì¬
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 5   

 239   3                    CURRENT_SON_PROCESS = PROCESS_Command_reset_Step3;
 240   3                    SysModle = SystermIdle;
 241   3                     break;
 242   3      //            if((!EntrySensor )||(!SavftyEdag))  //Èç¹ûÔÚ¸Ã´¦ÅÐ¶ÏÓÐÕÚµ²Îï¾ÍÖ»·¢ÐÅÏ¢¸æÖª?           
 243   3      //            {
 244   3      //              Stop_Door_run();
 245   3      //              delay(50);
 246   3      //              while(CloseStopDoorRun!=0)
 247   3      //                {
 248   3      //                Positive_Door_run();
 249   3      //                  }
 250   3      //              
 251   3      //              Stop_Door_run();
 252   3      //              delay(50);
 253   3      // //                            Negative_Door_run();
 254   3      // //             break;
 255   3      //             }
 256   3      //             else if(EntrySensor&&SavftyEdag)     //ÈëÊé¿ÚÎÞÕÏ°­£¬¹ØÃÅ
 257   3      //             {
 258   3      //              Negative_Door_run();
 259   3      //             } 
 260   3                  
 261   3                break;
 262   3                
 263   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; //¸´Î»Íê±Ï£¬ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬
 264   3                  break;
 265   3            }
 266   2            break;
 267   2            #endregion
*** WARNING C315 IN LINE 267 OF equipment.c: unknown #directive 'endregion'
 268   2          
 269   2            
 270   2            #region ´«ËÍ´øÕý×ª
*** WARNING C315 IN LINE 270 OF equipment.c: unknown #directive 'region'
 271   2          case PROCESS_Command_prog_direct :                  
 272   2            switch(CURRENT_SON_PROCESS)
 273   2            {
 274   3              case  PROCESS_Command_prog_direct_Step0:
 275   3                  send_string_com(Re_prog_direct);          //ÉÏ±¨´«ËÍ´øÕý×ªÖ¸ÁîÊÕµ½
 276   3                  prog_direct_running();              //´«ËÍ´øÕý×ª
 277   3                  send_string_com(init_report_s17);         //ÉÏ±¨´«ËÍ´øÕý×ª
 278   3                  prog_reset_250times = 4*60;           //µç»ú×ª¶¯Ê±¼ä60Ãë
 279   3                  CURRENT_SON_PROCESS   = PROCESS_Command_prog_direct_Step1;
 280   3                  SysModle = SystermBussy;
 281   3                  break;
 282   3              case  PROCESS_Command_prog_direct_Step1:                   
 283   3                  if(prog_reset_250times == 0)  //  || (!door_running_250times))    
 284   3                  {
 285   4                     prog_stop_running();
 286   4                   CURRENT_SON_PROCESS  = PROCESS_Command_prog_direct_Step2;
 287   4                   break;
 288   4                  }
 289   3                  else
 290   3                     CURRENT_SON_PROCESS  = PROCESS_Command_prog_direct_Step2;
 291   3                  break;
 292   3              case  PROCESS_Command_prog_direct_Step2:
 293   3                     SysModle = SystermIdle;  
 294   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; //ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬          
 295   3                  break;
 296   3            }
 297   2            break;
 298   2            #endregion
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 6   

*** WARNING C315 IN LINE 298 OF equipment.c: unknown #directive 'endregion'
 299   2          
 300   2            
 301   2            #region ´«ËÍ´ø·´×ª
*** WARNING C315 IN LINE 301 OF equipment.c: unknown #directive 'region'
 302   2            
 303   2          case PROCESS_Command_prog_reverse :                   
 304   2            switch(CURRENT_SON_PROCESS)
 305   2            {
 306   3              case  PROCESS_Command_prog_reverse_Step0:
 307   3                  send_string_com(Re_prog_reverse);         //ÉÏ±¨´«ËÍ´øÕý×ªÖ¸ÁîÊÕµ½
 308   3                  prog_Reverse_running();             //´«ËÍ´ø·´×ª
 309   3                  send_string_com(init_report_s18);         //ÉÏ±¨´«ËÍ´ø·´×ª
 310   3                  prog_reset_250times = 4*60;           //µç»ú×ª¶¯Ê±¼ä60Ãë
 311   3                  CURRENT_SON_PROCESS   = PROCESS_Command_prog_reverse_Step1;
 312   3                  SysModle = SystermBussy;
 313   3                  break;
 314   3              case  PROCESS_Command_prog_reverse_Step1:                  
 315   3                  if(prog_reset_250times == 0)  //  || (!door_running_250times))    
 316   3                  {
 317   4                     prog_stop_running();
 318   4                   CURRENT_SON_PROCESS  = PROCESS_Command_prog_reverse_Step2;
 319   4                   break;
 320   4                  }
 321   3                  else
 322   3                     CURRENT_SON_PROCESS  = PROCESS_Command_prog_reverse_Step2;
 323   3                  break;
 324   3              case  PROCESS_Command_prog_reverse_Step2:
 325   3                     SysModle = SystermIdle;  
 326   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; //ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬          
 327   3                  break;
 328   3            }
 329   2            break;
 330   2            #endregion
*** WARNING C315 IN LINE 330 OF equipment.c: unknown #directive 'endregion'
 331   2            
 332   2            
 333   2      
 334   2           
 335   2            #region ´«ËÍ´øÍ£Ö¹
*** WARNING C315 IN LINE 335 OF equipment.c: unknown #directive 'region'
 336   2          case PROCESS_Command_prog_stop :                  
 337   2            switch(CURRENT_SON_PROCESS)
 338   2            {
 339   3              case  PROCESS_Command_prog_stop_Step0:
 340   3                  send_string_com(Re_prog_stop);          //ÉÏ±¨´«ËÍ´øÕý×ªÖ¸ÁîÊÕµ½
 341   3                  SysModle = SystermBussy;
 342   3                  prog_stop_running();
 343   3                  send_string_com(init_report_s19);         //ÉÏ±¨´«ËÍ´øÍ£Ö¹
 344   3                  SysModle = SystermIdle;             //´«ËÍ´ø·´×ª  
 345   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; //ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬          
 346   3                  break;
 347   3            }
 348   2            break;
 349   2            #endregion
*** WARNING C315 IN LINE 349 OF equipment.c: unknown #directive 'endregion'
 350   2            
 351   2            
 352   2            #region ÈëÊé²Ù×÷
*** WARNING C315 IN LINE 352 OF equipment.c: unknown #directive 'region'
 353   2          case PROCESS_Command_book_in:
 354   2            switch(CURRENT_SON_PROCESS)
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 7   

 355   2            {  
 356   3              case  PROCESS_Command_book_in_Step0:
 357   3                  send_string_com(Re_book_in);
 358   3                  door_running_250times = 4*4;          //¹ØÃÅ½çÏÞÎª3Ãë 2013.5.7
 359   3              //    Positive_Door_run();
 360   3                  BoxSensor_on_times = 0;         //ÈëÏä´«¸ÐÆ÷³õÊ¼»¯
 361   3                  SysModle = SystermBussy;
 362   3      //            conveyor_run = 0;           //´«ËÍ´øÆô¶¯ÐÅºÅ
 363   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step1;
 364   3                  break;
 365   3      
 366   3              case  PROCESS_Command_book_in_Step1:
 367   3                   door_NErunning_250times=4*60;
 368   3                             book_in_Running_250times = 4*10;       //ÈëÊé´«ËÍ´øÕý´«5s  ¸ÄÎª6s 
 369   3      //             while(CloseStopDoorRun != 0)//||door_running_250times)    //ÃÅµ½Î»Í£Ö¹9.22
 370   3      //                        {
 371   3      //                            Positive_Door_run();
 372   3      //                        }
 373   3                             Stop_Door_run();
 374   3                             send_string_com(init_report_s9);                     //ÉÏ±¨¿ªÃÅµ½Î»            
 375   3                             CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step2;
 376   3                   break;
 377   3      
 378   3              case  PROCESS_Command_book_in_Step2:
 379   3                             if((ReadSensor==0) && door_NErunning_250times )                    //Èç¹û¼ì²éµ½ÓÐÎïÌå·ÅÈë 
 380   3                             {                                           
 381   4                                 //QuerySysDeviceState();
 382   4                                 SysState=1;
 383   4                                 door_NErunning_250times=4*60;
 384   4                                 book_in_Running_250times = 4*8;
 385   4                                 prog_direct_running();                                               //´«ËÍ´øÕý
             -×ª
 386   4                                 CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step3;
 387   4                                 break;
 388   4                             }
 389   3                             else if(door_NErunning_250times==0)
 390   3                             {                                               
 391   4                                           SysState=0;
 392   4                                  CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step6;
 393   4                                           break;
 394   4                             }
 395   3                             break;
 396   3              case  PROCESS_Command_book_in_Step3:
 397   3                             if(book_in_Running_250times) 
 398   3                             {
 399   4                                 if((BoxSensor==1)&&(ReadSensor==1))  
 400   4                                 {
 401   5                            //     CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step2;
 402   5                            //     Negative_Door_run();
 403   5                                    break;
 404   5                                 }
 405   4                                 else if((BoxSensor==1)&&(ReadSensor==0))
 406   4                                 {          
 407   5                          //       CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 408   5                                    break;
 409   5                                 }
 410   4                                 else if((BoxSensor_on_times>5)&&(ReadSensor==1))    //2014.12.29 ·À¶¶´¦Àí
 411   4                                 {          
 412   5                                     prog_stop_running();
 413   5                                     CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step4;
 414   5                                     //Negative_Door_run();
 415   5                                     door_NErunning_250times=4*10;
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 8   

 416   5                                     break;
 417   5                                 }
 418   4                                 else if((BoxSensor==0)&&(ReadSensor==0))
 419   4                                 {
 420   5                                     prog_stop_running();
 421   5                                     CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 422   5                                     break;
 423   5                                 }
 424   4                                 break;
 425   4                           }
 426   3              
 427   3                            else if(book_in_Running_250times==0)        //ÈëÊé³¬Ê±
 428   3                           {
 429   4                               SysState=0;
 430   4                               prog_stop_running();
 431   4                               if((BoxSensor==1)&&(ReadSensor==1))  
 432   4                               {
 433   5                                   send_string_com(init_report_s133);   // 2014.8.11 ÉÏ±¨ÈëÊé³¬Ê± Ë¢ÐÂ½çÃæ
 434   5                                   CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step2;
 435   5                                   break;
 436   5                               }
 437   4                               else if((BoxSensor==1)&&(ReadSensor==0))
 438   4                               {          
 439   5                        //       CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 440   5                                    break;
 441   5                               }
 442   4                               else if((BoxSensor==0)&&(ReadSensor==1))
 443   4                               {          
 444   5                                   CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step4;
 445   5                                   Negative_Door_run();
 446   5                                   door_NErunning_250times=4*10;
 447   5                                   break;
 448   5                               }
 449   4                              else if((BoxSensor==0)&&(ReadSensor==0))
 450   4                              {
 451   5                                    CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 452   5                                    break;
 453   5                              }
 454   4                              break;
 455   4                         }
 456   3                         else
 457   3                            break;                                   
 458   3                         break;
 459   3                              
 460   3               case  PROCESS_Command_book_in_Step4: 
 461   3      
 462   3      //                if((OpenStopDoorRun==0))//||(!door_NErunning_250times))
 463   3      //            {
 464   3      //                Stop_Door_run();
 465   3      //              send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 466   3      //                CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 467   3      //              break;            
 468   3      //            }
 469   3      //            if(((EntrySensor==0 )||(SavftyEdag==0)||(ReadSensor==0))&& door_NErunning_250times)   //·À¼ÐÊÖ
 470   3      //            {
 471   3      //              Stop_Door_run();
 472   3      //              send_string_com(init_report_s21);    //ÉÏ±¨»¹Êé¿ÚÓÐÒìÎï
 473   3      //              delay(50);
 474   3      //              while(CloseStopDoorRun!=0)
 475   3      //              {
 476   3      //                Positive_Door_run();
 477   3      //                }             
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 9   

 478   3      //              Stop_Door_run();
 479   3      //              delay(50);
 480   3      //              break;
 481   3      //              }
 482   3      //            else if(EntrySensor&&SavftyEdag&&ReadSensor&&door_NErunning_250times)     //ÈëÊé¿ÚÎÞÕÏ°­£¬¹ØÃÅ
 483   3      //            {
 484   3      //              Negative_Door_run();
 485   3      //              break;
 486   3      //            }
 487   3      //            else if(door_NErunning_250times==0)
 488   3      //            {
 489   3      //              Stop_Door_run();
 490   3      //              delay(10);
 491   3      //              CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 492   3      //              send_string_com(init_report_s12);      //ÉÏ±¨¹ØÃÅÊ§°Ü
 493   3      //              break;
 494   3      //            } 
 495   3                  send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 496   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 497   3                  break;
 498   3                  
 499   3                case  PROCESS_Command_book_in_Step5:           
 500   3                  if(ReadSensor==0)         //Èç¹ûÍ¼ÊéÒÑ¾­½øÈë£¬µ«ÊÇ¶Á¿¨Æ÷Ç°¹âµç¼ì²âµ½Í¼Êé£¬ÈÏÎªÍ¼Êé³¬³¤»òÁ¬Ðø·ÅÊé
 501   3                  {
 502   4                    Stop_Door_run();
 503   4                    BoxSensor_on_times = 0;           //Éè¶¨ÎªÈëÊéÊ§°Ü×´Ì¬
 504   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 505   4                    send_string_com(init_report_s20);    //Ö÷¶¯ÉÏ±¨Í¼Êé³¬³¤
 506   4                    break;
 507   4                  }
 508   3                    
 509   3                  else //if(BoxSensor_on_times > 0)                 
 510   3                  {
 511   4                    send_string_com(init_report_s131);      //ÈëÊé³É¹¦
 512   4                    send_string_com(init_report_s131);
 513   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 514   4                    
 515   4                    //prog_direct_running();
 516   4                    
 517   4                    //door_running_250times = 4*4;  
 518   4                    
 519   4                    break;
 520   4                  }
 521   3      //            else
 522   3      //            {               
 523   3      //              send_string_com(init_report_s132);            //2014.12.25   Ôö¼Ó
 524   3      //              CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 525   3      //              break;
 526   3      //            }
 527   3                /*  else                      //Ô­³ÌÐòÈ¡ÏûÁË³¬³¤Í¼Êé¼ì²â£¬ÉÏ±¨ÈëÊéÊ§°Ü
 528   3                  {   
 529   3                    send_string_com(init_report_s132);      //ÈëÊéÊ§°Ü
 530   3                  } */
 531   3                case  PROCESS_Command_book_in_Step6:
 532   3      //            if((OpenStopDoorRun==0))//||(!door_NErunning_250times))
 533   3      //            {
 534   3      //                Stop_Door_run();
 535   3      //              send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 536   3      //                CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 537   3      //              break;            
 538   3      //            }
 539   3      //            if((EntrySensor==0 )||(SavftyEdag==0)||(ReadSensor==0))   //·À¼ÐÊÖ
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 10  

 540   3      //            {
 541   3      //              Stop_Door_run();
 542   3      //              delay(50);
 543   3      //              while(CloseStopDoorRun!=0)
 544   3      //              {
 545   3      //                Positive_Door_run();
 546   3      //                }             
 547   3      //              Stop_Door_run();
 548   3      //              delay(50);
 549   3      // //                            Negative_Door_run();         //²»¹ØÃÅ
 550   3      //              break;
 551   3      //              }
 552   3      //            else if(EntrySensor&&SavftyEdag&&ReadSensor)      //ÈëÊé¿ÚÎÞÕÏ°­£¬¹ØÃÅ
 553   3      //            {
 554   3      //              Negative_Door_run();
 555   3      //              break;
 556   3      //            } 
 557   3                  send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 558   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 559   3                  break;
 560   3      
 561   3                case  PROCESS_Command_book_in_Step7:
 562   3                      SysState=0;
 563   3                      delay(1500);
 564   3                      V12_2=1;
 565   3                  SysModle = SystermIdle;
 566   3                default:CURRENT_FATHER_PROCESS = PROCESS_Command_Idle;  //ÈëÊéÍê±Ï£¬ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬
 567   3               break;
 568   3            }
 569   2            break;
 570   2      #endregion 
*** WARNING C315 IN LINE 570 OF equipment.c: unknown #directive 'endregion'
 571   2            
 572   2            
 573   2            #region ½áÊøÃüÁî
*** WARNING C315 IN LINE 573 OF equipment.c: unknown #directive 'region'
 574   2          case PROCESS_Command_End://½áÊøÖ¸Áî   
 575   2                switch(CURRENT_SON_PROCESS)
 576   2                {
 577   3                        case  PROCESS_Command_End_Step0:
 578   3                                    send_string_com(Re_close_drop);
 579   3                                    door_NErunning_250times = 4*4;
 580   3                                  book_out_Running_250times = 4*2;
 581   3                              //      Negative_Door_run();
 582   3                           //2014.8.1   prog_direct_running();
 583   3                                    CURRENT_SON_PROCESS = PROCESS_Command_End_Step1;
 584   3                              SysModle = SystermBussy;
 585   3      //                  conveyor_run = 1;           //´«ËÍ´øÍ£Ö¹ÐÅºÅ
 586   3                            break;
 587   3                      
 588   3                        case  PROCESS_Command_End_Step1:
 589   3      //                        if((OpenStopDoorRun == 0))// ||(!door_NErunning_250times))    
 590   3      //                        {
 591   3      //                            Stop_Door_run();
 592   3      //                //          if(!door_NErunning_250times)         //È¥µôÊ±ÏÞÅÐ¶Ï
 593   3      //                //          {
 594   3      //                            prog_stop_running();
 595   3      //                            send_string_com(init_report_s11);        //¹ØÃÅµ½Î»ÉÏ±¨
 596   3      //                            CURRENT_SON_PROCESS = PROCESS_Command_End_Step2;
 597   3      //                //          }
 598   3      //                        }
 599   3      //                        if((EntrySensor==0 )||(SavftyEdag==0)||(ReadSensor==0)||(door_NErunning_250times==0))
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 11  

             -    
 600   3      //                        {
 601   3      //                            Stop_Door_run();
 602   3      //                  //2014.8.1          prog_stop_running();
 603   3      //                            delay(50);
 604   3      //                            while(CloseStopDoorRun!=0)
 605   3      //                            {
 606   3      //                              Positive_Door_run();
 607   3      //                            }                 
 608   3      //                            Stop_Door_run();
 609   3      //                       //   delay(50);
 610   3      //                            delay_200msx(10);
 611   3      //                            door_NErunning_250times=4*4;                                  
 612   3      //                        }
 613   3      //                        else if(EntrySensor && SavftyEdag && ReadSensor)
 614   3      //                        {
 615   3      //                            Negative_Door_run();
 616   3      //                        }
 617   3                              delay_200msx(5);
 618   3                              prog_stop_running();
 619   3                              send_string_com(init_report_s11);        //¹ØÃÅµ½Î»ÉÏ±¨
 620   3                              CURRENT_SON_PROCESS = PROCESS_Command_End_Step2;
 621   3                              break;
 622   3      
 623   3                        case PROCESS_Command_End_Step2:             
 624   3                            default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; 
 625   3                  break;
 626   3                      
 627   3                }
 628   2                break;
 629   2            #endregion
*** WARNING C315 IN LINE 629 OF equipment.c: unknown #directive 'endregion'
 630   2            
 631   2            
 632   2            
 633   2            #region ÍËÊé²Ù×÷
*** WARNING C315 IN LINE 633 OF equipment.c: unknown #directive 'region'
 634   2            
 635   2          case PROCESS_Command_book_out:
 636   2            switch(CURRENT_SON_PROCESS)
 637   2            {
 638   3              case  PROCESS_Command_book_out_Step0:
 639   3                  send_string_com(Re_book_out);         //ÍËÊéÃüÁî·´À¡
 640   3              case  PROCESS_Command_book_out_StepF:    
 641   3                  book_out_Running_250times = 4*4;        //ÍËÊé´«ËÍ´øÕý´«5S
 642   3                              door_NErunning_250times   = 4*4;          //¿ªÃÅÊ±¼ä½çÏÞ3Ãë
 643   3              //      Positive_Door_run();                 //¿ªÃÅ    2013.5.7 
 644   3                             
 645   3                  prog_Reverse_running();
 646   3                  ReadSensor_on_times = 0;
 647   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step1;
 648   3                  ReadSensor_on_timeout_250times = 4*60;      //ÉèÖÃµÈ´ýÍËÊéºóµÈ´ý¶ÁÕßÈ¡ÊéÊ±¼äÎª60Ãë
 649   3                  break;
 650   3              case  PROCESS_Command_book_out_Step1:
 651   3      //            if(CloseStopDoorRun == 0)//||!door_NErunning_250times)     //²»¼ÓÈë³¬Ê±ÅÐ¶Ï
 652   3      //              {
 653   3      //                Stop_Door_run();
 654   3      //            } 
 655   3                  if(book_out_Running_250times)
 656   3                  {
 657   4                    if(ReadSensor_on_times  >= 10)        //¼ì²é¶Á¿¨Ç°¹âµçÓÐÐ§ÐÅºÅ10msÂË²¨
 658   4                    {
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 12  

 659   5                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step2;
 660   5                    }
 661   4                  }
 662   3                  else
 663   3                  {
 664   4                    prog_stop_running();
 665   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step2; 
 666   4                  }
 667   3                  break;
 668   3              case  PROCESS_Command_book_out_Step2:
 669   3              //    book_out_Running_250times_bake = book_out_Running_250times;
 670   3                  if(book_out_Running_250times > 0)       //Èç¹ûÊéÍËµ½¶Á¿¨Ç°¹â£¬Ôò¼ÌÐø1sÑÓÊ±
 671   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step9;         //ÍËÊéÑÓÊ±Ê±¼ä500ºÁÃë
 672   3                  else
 673   3                  {
 674   4                      send_string_com(init_report_s151);
 675   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_StepA;      //·µ»Ø»¹ÊéÁ÷³Ì
 676   4                      SysModle = SystermIdle;
 677   4                  } 
 678   3                  break;
 679   3              case  PROCESS_Command_book_out_Step3:
 680   3                    if(!book_out_Running_250times) 
 681   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step4; 
 682   3                  break;
 683   3              case  PROCESS_Command_book_out_Step4:
 684   3                    prog_stop_running();    
 685   3                    QuerySysDeviceState();                //ÉÏ±¨ÊéÒÑ¾­µ½Èë¿Ú
 686   3                    ReadSensor_on_timeout_250times = 4*15;      //ÍË³öµÄµÚÒ»±¾ÊéÈ¡×ß³¬Ê±Ê±ÏÞ
 687   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step5; 
 688   3                    break;
 689   3              case  PROCESS_Command_book_out_Step5:
 690   3                    if(ReadSensor_on_timeout_250times)         //Èç¹ûµÈ´ý¶ÁÕßÈ¡×ßµÚÒ»±¾ÊéÎ´³¬Ê±£¬¼ÌÐøµÈ´ý
 691   3                    {
 692   4                     if(ReadSensor == 1)           //¶ÁÕßÈ¡×ßµÚÒ»±¾Êé£¬¼ÌÐøÍËµÚ¶þ±¾Êé
 693   4                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step6; 
 694   4                    }
 695   3                    else
 696   3                    {
 697   4                     CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step9;
 698   4                     door_NErunning_250times = 4*30;
 699   4                //     ReadSensor_on_timeout_250times = 4*25;           
 700   4                    }
 701   3                    break;
 702   3              case  PROCESS_Command_book_out_Step6:
 703   3                    prog_Reverse_running();       //´«ËÍ´ø·´×ª
 704   3                    ReadSensor_on_times = 0;
 705   3                    book_out_Running_250times = 4*3;    //book_out_Running_250times_bake;
 706   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step7;
 707   3                    break;
 708   3              case  PROCESS_Command_book_out_Step7:
 709   3                    if(book_out_Running_250times)  
 710   3                    {
 711   4                     if(ReadSensor_on_times   >= 200)         //¼ì²é¶Á¿¨Ç°¹âµçÓÐÐ§ÐÅºÅ10msÂË²¨
 712   4                     {
 713   5                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step8;
 714   5                      if(book_out_Running_250times > 0)     //Èç¹ûÊéÍËµ½¶Á¿¨Ç°¹â£¬Ôò¼ÌÐø1sÑÓÊ±
 715   5                      book_out_Running_250times = 0;      //ÍËÊéÑÓÊ±Ê±¼ä500ºÁÃë
 716   5                     }      
 717   4                    }
 718   3                    else
 719   3                    {
 720   4                       CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step8;
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 13  

 721   4                    }           
 722   3                    break;
 723   3              case  PROCESS_Command_book_out_Step8:
 724   3                  
 725   3                    if(!book_out_Running_250times)
 726   3                    {
 727   4                     CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step9;
 728   4                     ReadSensor_on_timeout_250times = 4*40;
 729   4                     door_NErunning_250times = 4*30;
 730   4                     prog_stop_running();           
 731   4                    }
 732   3                    break;
 733   3              case  PROCESS_Command_book_out_Step9:
 734   3                  if(book_out_Running_250times==0)
 735   3                    prog_stop_running();
 736   3                    if((ReadSensor_on_times)&&(ReadSensor_on_timeout_250times))   
 737   3                    //Èç¹ûµÚ¶þ±¾ÊéÍËµ½Èë¿Ú»òÍË³öµÈ´ý60ÃëÈ¡Êé³¬Ê±£¬±¨³É¹¦
 738   3                    {
 739   4                      break;
 740   4                    }
 741   3                    else if((ReadSensor_on_times)&&(ReadSensor_on_timeout_250times==0))
 742   3                  {
 743   4                    if(door_NErunning_250times)
 744   4                    {
 745   5                        prog_Reverse_running();
 746   5                    }
 747   4                    else
 748   4                        prog_stop_running();
 749   4                    break;
 750   4                  }
 751   3                  else if((ReadSensor_on_times==0)&&(ReadSensor_on_timeout_250times))
 752   3                  {             
 753   4                    prog_stop_running();
 754   4                    send_string_com(init_report_s151);      //ÉÏ±¨ÍËÊé³É¹¦
 755   4                  }
 756   3                  else if((ReadSensor_on_times==0)&&(ReadSensor_on_timeout_250times==0))
 757   3                  {
 758   4                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_StepB;    //¹ØÃÅ
 759   4                    prog_stop_running();
 760   4                    door_NErunning_250times = 4*4;
 761   4                    break;
 762   4                  }
 763   3                  if(sys_timeout_flag)
 764   3                  {
 765   4                    sys_timeout_flag=0;
 766   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_StepB;
 767   4                    break;
 768   4                  }
 769   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_out_StepA;      //·µ»Ø»¹ÊéÁ÷³Ì
 770   3                  SysModle = SystermIdle; 
 771   3                  
 772   3              case  PROCESS_Command_book_out_StepA:       
 773   3                      CURRENT_FATHER_PROCESS=PROCESS_Command_book_in;
 774   3                      CURRENT_SON_PROCESS=PROCESS_Command_book_in_Step0;
 775   3                  break;          
 776   3              //default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle;  //ÍËÊéÍê±Ï£¬ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬
 777   3              case  PROCESS_Command_book_out_StepB:
 778   3      //                if((OpenStopDoorRun==0))//||(!door_NErunning_250times))
 779   3      //                {
 780   3      //                    Stop_Door_run();
 781   3      //            //    SysModle = SystermIdle;
 782   3      //                prog_stop_running();
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 14  

 783   3      //                  send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 784   3      //                CURRENT_SON_PROCESS=PROCESS_Command_book_out_StepC;
 785   3      //                    break;            
 786   3      //                }
 787   3      //                if((EntrySensor==0 )||(SavftyEdag==0)||(ReadSensor==0)||(door_NErunning_250times==0))   //·À¼
             -ÐÊÖ
 788   3      //                {
 789   3      //                  Stop_Door_run();
 790   3      //                  delay(50);
 791   3      //                  while(CloseStopDoorRun!=0)
 792   3      //                  {
 793   3      //                    Positive_Door_run();
 794   3      //                    }             
 795   3      //                  Stop_Door_run();
 796   3      //                  delay_200msx(10);
 797   3      //                door_NErunning_250times = 4*4;
 798   3      //                  break;
 799   3      //                  }
 800   3      //                else if(EntrySensor&&SavftyEdag&&ReadSensor)      //ÈëÊé¿ÚÎÞÕÏ°­£¬¹ØÃÅ
 801   3      //                {
 802   3      //                  Negative_Door_run();
 803   3      //                  break;
 804   3      //                }
 805   3                    if(ReadSensor_on_times >= 100)
 806   3                    {             
 807   4                        prog_stop_running();
 808   4                        send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 809   4                        CURRENT_SON_PROCESS=PROCESS_Command_book_out_StepC;
 810   4                        break;
 811   4                    }
 812   3                  break;
 813   3              case  PROCESS_Command_book_out_StepC:
 814   3                      SysModle = SystermIdle;
 815   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle;
 816   3                    break;
 817   3            }
 818   2            break;
 819   2            #endregion
*** WARNING C315 IN LINE 819 OF equipment.c: unknown #directive 'endregion'
 820   2            
 821   2            
 822   2            
 823   2            #region ÈëÏä²Ù×÷
*** WARNING C315 IN LINE 823 OF equipment.c: unknown #directive 'region'
 824   2          case PROCESS_Command_book_drop:       
 825   2            switch(CURRENT_SON_PROCESS)
 826   2            {
 827   3              case    PROCESS_Command_book_drop_Step0:
 828   3              
 829   3                  book_drop_Running_250times = 4*4;
 830   3                  send_string_com(Re_book_drop);
 831   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step1;
 832   3                  RevolEnable = 0;
 833   3                  V12_2=0;
 834   3                  while(serial_s3==0)  //µÈ´ýplcÃüÁî
 835   3                  {
 836   4                    ;
 837   4                  }
 838   3                  prog_book_drop_Return =  0x00;
 839   3                  conveyor_run = 0;       //Æô¶¯Á÷Ë®Ïß
 840   3                  break;
 841   3              case    PROCESS_Command_book_drop_Step1:
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 15  

 842   3                  if((!prog_book_drop_Return)&&(book_drop_Running_250times))
 843   3                  {
 844   4                    if(CURRENT_GRANDSON_PROCESS == CURRENT_GRANDSON_PROCESS_step0)
 845   4                    {
 846   5                      prog_book_drop_kind = 0;
 847   5                      if(BoxSensor_on_times != 0)
 848   5                        prog_book_drop_kind |=BoxSignalON;
 849   5                      if(ReadSensor_on_times != 0)
 850   5                        prog_book_drop_kind |=ReaderSignalON;
 851   5      
 852   5                    }    
 853   4                    switch(prog_book_drop_kind) 
 854   4                    {   
 855   5                      case ReaderSignalOFF|BoxSignalON:
 856   5                           switch(CURRENT_GRANDSON_PROCESS)
 857   5                           {
 858   6                             case CURRENT_GRANDSON_PROCESS_step0:
 859   6                                book_drop_Running_250times = 4*4;   //ÈëÊé´«ËÍ´øÕý´«4S
 860   6                                prog_direct_running();
 861   6                                CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step1;
 862   6                              break;
 863   6                             case CURRENT_GRANDSON_PROCESS_step1:
 864   6                                if(book_drop_Running_250times)
 865   6                                {
 866   7                                  if(BoxSensor_on_times == 0)
 867   7                                  {
 868   8                                    prog_book_drop_Return = 1;
 869   8                                    CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;
 870   8                                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step2;
 871   8                                    break;
 872   8                                  }
 873   7                                }
 874   6                                else
 875   6                                {
 876   7                                  CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;  
 877   7                                }
 878   6                               break;
 879   6                             default: 
 880   6                                CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;  
 881   6                                break;
 882   6                           }
 883   5                           break;
 884   5                      case ReaderSignalON|BoxSignalON:
 885   5      
 886   5                            switch(CURRENT_GRANDSON_PROCESS)
 887   5                            {
 888   6                                case CURRENT_GRANDSON_PROCESS_step0:
 889   6                                    book_drop_Running_250times = 4*4;   //ÈëÊé´«ËÍ´øÕý´«2S
 890   6                                  prog_direct_running();
 891   6                                  CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step1;
 892   6        
 893   6                                  break;
 894   6                                case CURRENT_GRANDSON_PROCESS_step1:
 895   6                                    if(book_drop_Running_250times)
 896   6                                  {
 897   7                                    if(BoxSensor_on_times == 0)
 898   7                                    {
 899   8                                      prog_book_drop_Return   = 1;
 900   8                                      RevolEnable       = 1;
 901   8                                        CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;
 902   8                                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step2;
 903   8      
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 16  

 904   8                                      break;
 905   8                                    }
 906   7                                  }
 907   6                                  else
 908   6                                  {
 909   7                                    CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;
 910   7        
 911   7                                  }
 912   6                                    break;
 913   6                                default: 
 914   6                                    CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;  
 915   6                                    break;
 916   6                            }
 917   5                            break;
 918   5                      case ReaderSignalON|BoxSignalOFF:
 919   5                      case ReaderSignalOFF|BoxSignalOFF:  
 920   5      
 921   5                            prog_direct_running();                    
 922   5                      default:  CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;
 923   5        
 924   5                            break;
 925   5                    }
 926   4                  }
 927   3                  else
 928   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step2;
 929   3                  break;
 930   3      
 931   3              case  PROCESS_Command_book_drop_Step2:
 932   3                  while(BoxSensor==0)
 933   3                  {
 934   4                    prog_direct_running();
 935   4                  }
 936   3                  delay(10);
 937   3          //2014.8.1        Positive_Door_run();
 938   3      //            while(BoxSensor==0)
 939   3      //            {
 940   3      //              prog_direct_running();
 941   3      //            }
 942   3                  delay(200);               //Èç¹ûÊéµô²»ÏÂÈ¥£¬¾Í½«Ê±¼ä¼Ó³¤
 943   3                  delay(200);             //ÔÝÊ±È¡ÏûÑÓÊ±        
 944   3                  delay(200);
 945   3                  delay(200);
 946   3                  delay(200);
 947   3                  conveyor_run = 1;       //Í£Ö¹Á÷Ë®Ïß
 948   3                  door_NErunning_250times = 4*4;
 949   3                  prog_stop_running();
 950   3                //  delay_200msx(7);   //ÑÓ³Ù1.4ÃëÔÙÉÏ±¨ÈëÏä³É¹¦   Èç¹û²»ºÏÊÊÔÙÈ¥µô
 951   3            //      Positive_Door_run();
 952   3                  send_string_com(init_report_s141);     //ÉÏ±¨ÈëÏä³É¹¦
 953   3                  send_string_com(init_report_s141);
 954   3                  send_string_com(init_report_s141);
 955   3            //      Positive_Door_run();     //2014.8.1
 956   3      //            while(CloseStopDoorRun != 0)//&&(door_NErunning_250times))             //2013.12.16 ||->&&
 957   3      //              {
 958   3      //                Positive_Door_run();  
 959   3      //            }
 960   3      //            Stop_Door_run();
 961   3      //            send_string_com(init_report_s9);           //ÉÏ±¨¿ªÃÅµ½Î»    
 962   3                  if(RevolEnable == 1)
 963   3                  {
 964   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step3;  //»Ø¹ö´¦Àí£¬Çø±ðÓëÍËÊé´¦Àí
 965   4                  }
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 17  

 966   3                  else
 967   3                      CURRENT_FATHER_PROCESS=PROCESS_Command_book_in;
 968   3                  CURRENT_SON_PROCESS=PROCESS_Command_book_in_Step0;
 969   3      
 970   3                  //CURRENT_SON_PROCESS = PROCESS_Command_book_drop_End;
 971   3                  break;
 972   3              /*ÈëÊé»Ø¹ö´¦*/
 973   3              case  PROCESS_Command_book_drop_Step3:
 974   3                  book_drop_Running_250times = 4*5;             //ÍËÊé´«ËÍ´øÕý´«5S
 975   3                  prog_Reverse_running();
 976   3                  //Light_red_on();
 977   3                  door_NErunning_250times = 4*2;
 978   3      //            Negative_Door_run();
 979   3      //            if(OpenStopDoorRun == 0)//||!door_NErunning_250times)            //ÃÅµ½Î»Í£Ö¹9.22
 980   3      //              {
 981   3      //                  Stop_Door_run();
 982   3      //              send_string_com(init_report_s11);                 //ÉÏ±¨¹ØÃÅµ½Î»
 983   3      //            }
 984   3      //            else if(door_NErunning_250times==0)
 985   3      //            {
 986   3      //              Stop_Door_run();
 987   3      //              send_string_com(init_report_s12);                 //ÉÏ±¨¹ØÃÅ³¬Ê±
 988   3      //            }
 989   3                  send_string_com(init_report_s11);                 //ÉÏ±¨¹ØÃÅµ½Î»
 990   3                  ReadSensor_on_times = 0;
 991   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step4;  
 992   3                  break;
 993   3              case  PROCESS_Command_book_drop_Step4:
 994   3                  if(book_drop_Running_250times)  
 995   3                  {
 996   4                    if(ReadSensor_on_times  >= 10)                  //¼ì²é¶Á¿¨Ç°¹âµçÓÐÐ§ÐÅºÅ10msÂË²¨
 997   4                    {
 998   5                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step5;  
 999   5                    }     
1000   4                  }
1001   3                  else
1002   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step5;  
1003   3                    break;
1004   3              case  PROCESS_Command_book_drop_Step5:
1005   3                  book_drop_Running_250times_bake = book_drop_Running_250times;
1006   3                  if(book_drop_Running_250times > 0)              //Èç¹ûÊéÍËµ½¶Á¿¨Ç°¹â£¬Ôò¼ÌÐø1sÑÓÊ±              book_drop_Running_
             -250times = 2;              //ÍËÊéÑÓÊ±Ê±¼ä500ºÁÃë
1007   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step6;
1008   3                  break;
1009   3              case  PROCESS_Command_book_drop_Step6:
1010   3                    if(!book_drop_Running_250times)
1011   3                    {
1012   4                    prog_stop_running();    
1013   4                    QuerySysDeviceState();
1014   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step7;
1015   4                    }
1016   3                   break;
1017   3              case  PROCESS_Command_book_drop_Step7:
1018   3                    if(!ReadSensor_on_times)
1019   3                    {
1020   4                    prog_Reverse_running();
1021   4                    //Light_red_on();
1022   4                    door_NErunning_250times = 4*3;
1023   4                    Negative_Door_run();
1024   4                    if(OpenStopDoorRun == 0)//||!door_NErunning_250times)            //door 9.22
1025   4                      {
1026   5                         Stop_Door_run();
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 18  

1027   5                       send_string_com(init_report_s11);        //ÉÏ±¨¹ØÃÅ½áÊø
1028   5                    }
1029   4                    else if(door_NErunning_250times==0)
1030   4                    {
1031   5                       Stop_Door_run();
1032   5                       send_string_com(init_report_s12);       //ÉÏ±¨¹ØÃÅ³¬Ê±
1033   5                    }   
1034   4                    ReadSensor_on_times = 0;
1035   4                    book_drop_Running_250times = book_drop_Running_250times_bake;
1036   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step8;
1037   4                    } 
1038   3                  break;
1039   3              case  PROCESS_Command_book_drop_Step8:
1040   3                  if(book_drop_Running_250times)  
1041   3                  {
1042   4                    if(ReadSensor_on_times  >= 10)              //¼ì²é¶Á¿¨Ç°¹âµçÓÐÐ§ÐÅºÅ10msÂË²¨
1043   4                    {
1044   5                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step9;  
1045   5                    }     
1046   4                  }
1047   3                  else
1048   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step9;          
1049   3                  break;
1050   3              case  PROCESS_Command_book_drop_Step9:
1051   3                    if(book_drop_Running_250times > 0)              //Èç¹ûÊéÍËµ½¶Á¿¨Ç°¹â£¬Ôò¼ÌÐø1sÑÓÊ±
1052   3                      book_drop_Running_250times = 2;               //ÍËÊéÑÓÊ±Ê±¼ä500ºÁÃë
1053   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_StepA;  
1054   3                    break;
1055   3              case  PROCESS_Command_book_drop_StepA:
1056   3                    if(book_drop_Running_250times)
1057   3                    {
1058   4                      break;
1059   4                    }
1060   3                    else
1061   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_End;          
1062   3                    prog_stop_running();
1063   3              case  PROCESS_Command_book_drop_End:
1064   3                    SysModle = SystermIdle;                       
1065   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle;     //ÈëÏäÍê±Ï£¬ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬
1066   3                  door_NErunning_250times = 4*2;
1067   3      //            Negative_Door_run();
1068   3      //            if(OpenStopDoorRun == 0||!door_NErunning_250times)             //door 9.22
1069   3      //              {
1070   3      //                Stop_Door_run();
1071   3      //              }   
1072   3                  break;
1073   3            }
1074   2            break;
1075   2            
1076   2            #endregion
*** WARNING C315 IN LINE 1076 OF equipment.c: unknown #directive 'endregion'
1077   2          
1078   2          case  PROCESS_Command_Idle:
1079   2          //    conveyor_run = 1;
1080   2      //        if(OpenStopDoorRun == 0)//||!door_NErunning_250times)            //door 9.22
1081   2      //          {
1082   2      //          Stop_Door_run();
1083   2      //    //      send_string_com(init_report_s11);
1084   2      //        }
1085   2      //        else if(door_NErunning_250times==0)
1086   2      //        {
1087   2      //          Stop_Door_run();
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 19  

1088   2      //    //      send_string_com(init_report_s12);
1089   2      //        }
1090   2          default: break;
1091   2        }
1092   1      }
1093          void ReceiveDateProcess(void)
1094          {
1095   1        uchar   i,i_BSP = CE_OK;
1096   1        uint crcTemp1,crcTemp2;
1097   1        if(RecvState == RecvStateEnd)
1098   1        {
1099   2          system_waiting_250times=4*60;    //2014.8.12 ÏµÍ³¿ÕÏÐµÈ´ýÊ±¼ä
1100   2          for(i=0;i<0x0B;i++)                                         //×ªÒÆÊý¾Ý£¬±ÜÃâÊý¾Ý´¦Àí¹ý³ÌÖÐ·¢ÉúÊý¾ÝÅö×²
1101   2          {                                                                    
1102   3            InBuff[i]=SerialInbuff[i];                                //½«½ÓÊÕ»º³åÇøµÄÊý¾Ý×ªÒÆ±¸·Ý   
1103   3            SerialInbuff[i]=0;                                        //½ÓÊÕ»º³åÇøÇåÁã                              
             -                                 
1104   3          }
1105   2          RecvState=RecvStateIdle;                      //Êý¾Ý´¦ÀíÍê±Ï£¬¿ÉÒÔ½ÓÊÕÐÂÃüÁî
1106   2          if((InBuff[10]!=0x03)||(InBuff[1]!=0x08))                   //changed by zhanglei 03-26
1107   2          {                                                               //ÅÐ¶ÏÊý¾ÝµÄ½áÎ²ºÍ³¤¶È                            
             -    
1108   3            i_BSP =  CE_NOCOMM;                                         //Í¨Ñ¶Êý¾Ý´íÎó£¨Í·,Î²,³¤¶È´í£©           
1109   3          }
1110   2          else
1111   2          { 
1112   3            crcbuf_In[0]=InBuff[2];                       //È¡ÃüÁîÂë
1113   3            crcbuf_In[1]=InBuff[3];                     //RSP
1114   3            crcbuf_In[2]=InBuff[4];                     //PARAMETER1 |
1115   3            crcbuf_In[3]=InBuff[5];                     //PARAMETER2 |   ²ÎÊý  
1116   3            crcbuf_In[4]=InBuff[6];                     //PARAMETER3 |
1117   3            crcbuf_In[5]=InBuff[7];                     //PARAMETER4 |
1118   3            EA=0;                             //CRC¼ÆËã¹ý³ÌÖÐ£¬¶ÌÔÝ½ûÖ¹ÖÐ¶Ï²úÉú         
1119   3            crcTemp1=CRC3(crcbuf_In, 6);                      //½«Ð£ÑéºóµÄÊý¾Ý´æÈë crcTemp1, crcbuf_In×÷Îªcrcbuf_In[6]Êý
             -×éµÄÊ×µØÖ·£¬»òÓÃ &(crcbuf_In[6])
1120   3            crcTemp2=InBuff[8];                               //crcÐ£ÑéÂëµÄ¸ß°ËÎ»    
1121   3            crcTemp2=crcTemp2<<8;                   //»ñÈ¡crcTemp2¸ß8Î»
1122   3            crcTemp2|=InBuff[9];                              //»ñÈ¡crcTemp2µÍ8Î»£¬ºÏ²¢³É16Î»
1123   3            EA=1;                                       //´ò¿ªÖÐ¶Ï 
1124   3            if(crcTemp1!=crcTemp2)                            //½«Ð£ÑéºóµÄÊý¾ÝºÍ½ÓÊÕµ½µÄÐ£ÑéÂë×÷±È½Ï
1125   3            {                                        
1126   4              i_BSP =  CE_CHECKERROR;                                 //Ð£ÑéÂë´í
1127   4            }
1128   3          }
1129   2          if(i_BSP == CE_OK)
1130   2          {
1131   3            //RD_command = InBuff[2];                 //Ö÷ÃüÁî
1132   3            //RD_command_Hpara1  = InBuff[4];                 //»ñÈ¡ÃüÁîÐ¯´øµÄ²ÎÊýHPARA_H 
1133   3            //RD_command_Hpara2  = InBuff[5] ;                //»ñÈ¡ÃüÁîÐ¯´øµÄ²ÎÊýHPARA_L
1134   3            //RD_command_Lpara1  = InBuff[6] ;                //»ñÈ¡ÃüÁîÐ¯´øµÄ²ÎÊýLPARA_H
1135   3            //RD_command_Lpara2  = InBuff[7] ;                //»ñÈ¡ÃüÁîÐ¯´øµÄ²ÎÊýLPARA_L
1136   3            host_command(InBuff[2],InBuff[4],InBuff[5]);//ÃüÁî´¦Àí,¾¡Á¿±ÜÃâÓÃÈ«¾Ö±äÁ¿£¬²ÉÓÃÐÎ²Îµ¼Èë
1137   3          }
1138   2          else
1139   2          {
1140   3            send_string_err(i_BSP);                   //·¢ËÍÍ¨Ñ¶´íÎóÐÅÏ¢
1141   3          }
1142   2        } 
1143   1      //   RD_command = Command_Idle;                     //Çå¿ÕÃüÁî¼Ä´æÆ÷
1144   1      //  RD_command_Hpara1  = 0; 
1145   1      //  RD_command_Hpara2  = 0 ;
1146   1      //  RD_command_Lpara1  = 0 ; 
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 20  

1147   1      //  RD_command_Lpara2  = 0 ; 
1148   1        for(i=0;i<0x0B;i++)                                           //×ªÒÆÊý¾Ý£¬±ÜÃâÊý¾Ý´¦Àí¹ý³ÌÖÐÐÂµÄÊý¾Ý
1149   1        {                                                                    
1150   2          InBuff[i]=0;                                          //½«Êý¾Ý±¸·ÝÇå¿ÕÎª0                                     
             -                           
1151   2        }
1152   1      } 
1153          
1154          void host_command(unsigned char RD_command,unsigned char RD_command_Hpara1,unsigned char RD_command_Hpara2
             -)
1155          {
1156   1        
1157   1        switch(RD_command)
1158   1        {
1159   2          case Command_reset: 
1160   2            { 
1161   3            //  if(CURRENT_FATHER_PROCESS !=  PROCESS_Command_Idle)
1162   3            //    send_string_err(CE_EXECUTE); 
1163   3            //  else
1164   3            //  { 
1165   3                CURRENT_FATHER_PROCESS  = PROCESS_Command_reset ; 
1166   3                CURRENT_SON_PROCESS = PROCESS_Command_reset_Step0;
1167   3                CURRENT_GRANDSON_PROCESS= CURRENT_GRANDSON_PROCESS_step0;
1168   3                TCounter250           = 0;  //250ºÁÃë¼ÆÊýÆ÷
1169   3      //          TCounter8             = 0;  //8ºÁÃë¼ÆÊýÆ÷
1170   3      //          Time8ms_flag          = 0;  //8ºÁÃë±êÖ¾
1171   3                Time250ms_flag          = 0;    //250Áë?          TCounter250           = 0;
1172   3      //          TCounter8           = 0;
1173   3      //          Time8ms_flag          = 0;
1174   3      //          Time250ms_flag          = 0;
1175   3                EntrySensor_on_times        = 0;
1176   3                ReadSensor_on_times         = 0;
1177   3                ReadSensor_on_timeout_250times  = 0;
1178   3                BoxSensor_on_times        = 0;
1179   3                prog_reset_250times       = 0;
1180   3                book_in_Running_250times      = 0;
1181   3                book_out_Running_250times     = 0;
1182   3            //    book_out_Running_250times_bake  = 0;
1183   3                book_drop_Running_250times    = 0;
1184   3                book_drop_Running_250times_bake = 0;
1185   3            //    book_stop_running_250tims     = 0;      
1186   3              }               
1187   2          //  }
1188   2            break;  
1189   2            
1190   2          case Command_book_action:                         //´«ËÍ´øÔËÐÐÃüÁî£¬¸ù¾Ý²ÎÊý·Ö±ð¾ßÌåµÄÏ¸·Ö¶¯×÷
1191   2          { 
1192   3            if((RD_command_Hpara1 == 0x02)&&(RD_command_Hpara2 == 0x02))  /* ½áÊø */
1193   3            {
1194   4                if((BoxSensor==1)&&(SysState==0))
1195   4              {
1196   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_End;
1197   5                  CURRENT_SON_PROCESS =  PROCESS_Command_End_Step0;
1198   5              }
1199   4              else
1200   4                send_string_err(CE_EXECUTE);                
1201   4            }
1202   3            else if((CURRENT_FATHER_PROCESS != PROCESS_Command_Idle))
1203   3              send_string_err(CE_EXECUTE); 
1204   3            else
1205   3            { 
1206   4              if((RD_command_Hpara1 == 0x01)&&(RD_command_Hpara2 == 0x01))    /* ÈëÊé */        
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 21  

1207   4              { 
1208   5                CURRENT_FATHER_PROCESS  =   PROCESS_Command_book_in ;
1209   5                CURRENT_SON_PROCESS =   PROCESS_Command_book_in_Step0;            
1210   5              }
1211   4              else if((RD_command_Hpara1 == 0x01)&&(RD_command_Hpara2 == 0x02)) /* ÍËÊé */
1212   4              {
1213   5                CURRENT_FATHER_PROCESS  =  PROCESS_Command_book_out   ;
1214   5                CURRENT_SON_PROCESS =  PROCESS_Command_book_out_Step0;                  
1215   5              }
1216   4              else if((RD_command_Hpara1 == 0x02)&&(RD_command_Hpara2 == 0x01))   /* ÈëÏä */
1217   4              {
1218   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_book_drop ;
1219   5                CURRENT_SON_PROCESS =  PROCESS_Command_book_drop_Step0; 
1220   5                CURRENT_GRANDSON_PROCESS=  CURRENT_GRANDSON_PROCESS_step0;            
1221   5              }
1222   4              else if((RD_command_Hpara1 == 0x03)&&(RD_command_Hpara2 == 0x01))   /* ´«ËÍ´øÕý×ª */
1223   4              {
1224   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_prog_direct ;
1225   5                CURRENT_SON_PROCESS =  PROCESS_Command_prog_direct_Step0;             
1226   5              }
1227   4              else if((RD_command_Hpara1 == 0x03)&&(RD_command_Hpara2 == 0x02))   /* ´«ËÍ´ø·´×ª */
1228   4              {
1229   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_prog_reverse ;
1230   5                CURRENT_SON_PROCESS =  PROCESS_Command_prog_reverse_Step0;              
1231   5              }
1232   4              else if((RD_command_Hpara1 == 0x03)&&(RD_command_Hpara2 == 0x03))   /* ´«ËÍ´øÍ£Ö¹ */
1233   4              {
1234   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_prog_stop ;
1235   5                CURRENT_SON_PROCESS =  PROCESS_Command_prog_stop_Step0;             
1236   5              }
1237   4              /*else if((RD_command_Hpara1 == 0x02)&&(RD_command_Hpara2 == 0x02))   /* ½áÊø */
1238   4              /*{
1239   4                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_End;
1240   4                CURRENT_SON_PROCESS   =  PROCESS_Command_End_Step0;         
1241   4              }*/
1242   4              else
1243   4                send_string_err(CE_BADPARAM);                   //·¢ËÍÃüÁî²ÎÊý´íÎó
1244   4            }
1245   3            break;
1246   3          }
1247   2          //////////////////////////////////////////////////////////////////////
1248   2          case Command_cleck_state:   
1249   2              prog_cleck_state();     /* ¼ì²é¹âÄ»×´Ì¬²¢·¢ËÍ¸øPC*/
1250   2              break;
1251   2          case Command_check_vison:   
1252   2              prog_check_vison();     /* ²éÑ¯°æ±¾ºÅ*/
1253   2              break;
1254   2          default:   
1255   2              send_string_err(CE_BADCOMMAND);                   //·¢ËÍÃüÁî´íÎó
1256   2              break;
1257   2        }
1258   1      }
1259          // prog_check_vison--------------------------------------
1260          void prog_cleck_state()
1261          {
1262   1        char i_Senser,j_Senser; 
1263   1        send_string_com(Re_che_state);
1264   1                                      
1265   1        i_Senser = P0;              //È¡P0.0~P0.3µÄ×´Ì¬
1266   1        i_Senser &= 0x0F;
1267   1        i_Senser = 0x0F - i_Senser;
1268   1        j_Senser = P2;              //È¡P2.4~P2.7µÄ×´Ì¬
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 22  

1269   1      //  j_Senser = ~j_Senser;
1270   1        j_Senser &= 0xE0;
1271   1        if(j_Senser == 0xE0)
1272   1        {
1273   2          delay_1msx(80);             //·ÀÎó±¨´¦Àí ÈçÎÞÕÚµ² ÔÙ¼ì²âÒ»´Î  80mmÐèÒª100ms
1274   2          i_Senser = P0;              //È¡P0.0~P0.3µÄ×´Ì¬
1275   2            i_Senser &= 0x0F;
1276   2            i_Senser = 0x0F - i_Senser;
1277   2            j_Senser = P2;              //È¡P2.4~P2.7µÄ×´Ì¬
1278   2      //      j_Senser = ~j_Senser;
1279   2            j_Senser &= 0xE0;
1280   2        }
1281   1        j_Senser = 0xE0 - j_Senser;                           //Í¨Ñ¶·µ»ØÎÞÐèÑÓÊ±
1282   1        i_Senser = (j_Senser | i_Senser);
1283   1        prog_check_state_report(i_Senser);
1284   1          
1285   1      }
1286          
1287          void prog_check_state_report(unsigned char i_Senser)                  //²éÑ¯Ö¸Áî·µ»Ø¹âÄ»×´Ì¬
1288          {
1289   1        unsigned char *i_str;
1290   1        if(i_Senser==0x00)
1291   1        {
1292   2          Re_data_erro[4] = i_Senser;
1293   2          Re_data_erro[5] = 0x01;
1294   2          i_str = Re_data_erro;
1295   2        }
1296   1        else
1297   1        {
1298   2            Re_data_erro[4] = i_Senser;
1299   2          Re_data_erro[5] = 0x00;
1300   2            i_str = Re_data_erro;
1301   2        }
1302   1      
1303   1        send_string_com(i_str); 
1304   1      }
1305          void prog_init_report(unsigned char i_Senser)           //Ö÷¶¯ÉÏ±¨¹âÄ»×´Ì¬
1306          {
1307   1        unsigned char *i_str;
1308   1        switch(i_Senser&0x0F)
1309   1        {
1310   2          case  0x00: i_str = init_report_s0   ;break;
1311   2          case  0x01: i_str = init_report_s1   ;break;
1312   2          case  0x02: i_str = init_report_s2   ;break;
1313   2          case  0x03: i_str = init_report_s3   ;break;
1314   2          case  0x04: i_str = init_report_s4   ;break;
1315   2          case  0x05: i_str = init_report_s5   ;break;
1316   2          case  0x06: i_str = init_report_s6   ;break;
1317   2          case  0x07: i_str = init_report_s7   ;break;
1318   2          case  0x08: i_str = init_report_s8   ;break;
1319   2      //    case  0x09: i_str = init_report_s9   ;break;
1320   2      //    case  0x0A: i_str = init_report_s10  ;break;
1321   2      //    case  0x0B: i_str = init_report_s11  ;break;
1322   2      //    case  0x0C: i_str = init_report_s12  ;break;
1323   2      //    case  0x0D: i_str = init_report_s13  ;break;
1324   2      //    case  0x0E: i_str = init_report_s14  ;break;
1325   2      //    case  0x0F: i_str = init_report_s15  ;break;
1326   2          default : i_str = init_report_s30  ;break;
1327   2        }
1328   1        send_string_com(i_str); 
1329   1      }
1330          
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         05/31/2023 14:07:32 PAGE 23  

1331          // prog_check_vison--------------------------------------
1332          void prog_check_vison()
1333          {
1334   1        ;//send_string_com(Re_check_vison);
1335   1      }
1336          // initiative_report--------------------------------------
1337          void QuerySysDeviceState(void)              //Éè±¸×Ô¶¯²éÑ¯Éè±¸×´Ì¬²¢ÉÏ±¨
1338          {             
1339   1        uchar temp;                       //¶¨ÒåÒ»¸öÁÙÊ±±äÁ¿ 
1340   1          
1341   1        temp  = SysDeviceState&0x0F;                //±¸·ÝÉÏ´Î´«¸ÐÆ÷µÄ×´Ì¬µ½temp
1342   1        
1343   1        SysDeviceState=0X00;                    //µ±Ç°×´Ì¬ÇåÁã£¬ÒÔ±ãÖØÐÂ²éÑ¯×´Ì¬
1344   1        
1345   1        if(EntrySensor_on_times >= EnterSensor_signal_on)   //ÅÐ¶ÏÈë¿Ú¹âÄ»ÓÐÎïÌå
1346   1           SysDeviceState = SysDeviceState|EnterSensorFlag; //»ñÈ¡Èë¿Ú¹âÄ»×´Ì¬
1347   1        
1348   1        if(ReadSensor_on_times  >= ReadSensor_signal_on)    //ÅÐ¶Ï¶Á¿¨Æ÷Ç°Ò»µÀ¹âÄ»
1349   1           SysDeviceState = SysDeviceState|ReadSensorFlag;  //»ñÈ¡¶Á¿¨Æ÷Ç°×´Ì¬
1350   1        
1351   1        if(BoxSensor_on_times   >= BoxSensor_signal_on)     //ÅÐ¶ÏÈëÏä¹âÄ»¼ì²â
1352   1           SysDeviceState = SysDeviceState|BoxSensorFlag; //»ñÈ¡ÈëÏä¹âÄ»×´Ì¬
1353   1      
1354   1          if(temp != (SysDeviceState&0x0F))                 //×îÖÕ±È½Ïµ±Ç°¹âÄ»×´Ì¬ÓëÉÏ´Î¹âÄ»×´Ì¬ÊÇ·ñ·¢Éú±ä»¯ 
1355   1          {  
1356   2          prog_init_report(SysDeviceState&0x0F);      //ÓÐ±ä»¯£¬ÉÏ±¨µ±Ç°×´Ì¬ 
1357   2          }                                       //ÎÞ±ä»¯£¬×´Ì¬²»ÉÏ±¨                                                
             -      
1358   1      } 
1359          
1360          void delay(uint num)
1361          {
1362   1       uchar i;
1363   1       while(num--)
1364   1       for(i=110;i>0;i--);
1365   1      }
1366            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2679    ----
   CONSTANT SIZE    =    451    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  16 WARNING(S),  0 ERROR(S)
