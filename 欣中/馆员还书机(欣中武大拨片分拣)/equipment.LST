C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE EQUIPMENT
OBJECT MODULE PLACED IN equipment.OBJ
COMPILER INVOKED BY: D:\Keil5\Keil5_C51\C51\BIN\C51.EXE equipment.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          //---------------------------------------------------------------------
   2          //   PROG : 
   3          //   DATE : 2014.2
   4          //   COMP : sh-rfid
   5          //   DESP : all file list
   6          //---------------------------------------------------------------------
   7          #include "include.h"
   8          
   9          #define  ReaderSignalON     0x02
  10          #define  ReaderSignalOFF    0x00
  11          #define  BoxSignalON      0x01
  12          #define  BoxSignalOFF     0x00
  13          //¸´Î»ÃüÁî·´À¡
  14          code char Re_reset[]    = {0x82,0x08,0x21,0x00,0x00,0x00,0x00,0x00,0xA6,0xE3,0x83};  
  15          //ÈëÊéÃüÁî·´À¡ 
  16          code char Re_book_in[]    = {0x82,0x08,0x22,0x00,0x01,0x01,0x00,0x00,0xBC,0xA9,0x83}; 
  17          //ÍËÊéÃüÁî·´À¡ 
  18          code char Re_book_out[]   = {0x82,0x08,0x22,0x00,0x01,0x02,0x00,0x00,0xD8,0x46,0x83};
  19          //ÈëÏäÃüÁî·´À¡  
  20          code char Re_book_drop[]    = {0x82,0x08,0x22,0x00,0x02,0x01,0x00,0x00,0x71,0x8C,0x83};
  21          //½áÊøÃüÁî
  22          code char Re_close_drop[]   = {0x82,0x08,0x22,0x00,0x02,0x02,0x00,0x00,0x15,0x63,0x83}; 
  23          //¹Ì¼þ°æ±¾²éÑ¯·µ»Ø
  24          //code char Re_check_vison[]  = {0x82,0x08,0x40,0x00,version_H,version_L,0x00,0x00,0xDE,0xAB,0x83};// //1.
             -1
  25          //´«ËÍ´øÕÅ×ª
  26          code char Re_prog_direct[]  = {0x82,0x08,0x22,0x00,0x03,0x01,0x00,0x00,0x71,0x8C,0x83};
  27          //´«ËÍ´ø·´×ª
  28          code char Re_prog_reverse[] = {0x82,0x08,0x22,0x00,0x03,0x02,0x00,0x00,0x71,0x8C,0x83};
  29          //´«ËÍ´øÍ£Ö¹
  30          code char Re_prog_stop[]    = {0x82,0x08,0x22,0x00,0x03,0x03,0x00,0x00,0x71,0x8C,0x83};
  31          
  32          //Ö÷¶¯ÉÏ±¨·µ»Ø
  33          code char init_report_s0[]    = {0x82,0x08,0x23,0x00,0x00,0x00,0x00,0x00,0x4B,0xf7,0x83};   //È«²¿Çå³ý
  34          code char init_report_s1[]    = {0x82,0x08,0x23,0x00,0x01,0x00,0x00,0x00,0x4B,0xf7,0x83};   //1ºÅ¹âÄ»±»ÕÚµ²
  35          code char init_report_s2[]    = {0x82,0x08,0x23,0x00,0x02,0x00,0x00,0x00,0x86,0xD2,0x83};   //2ºÅ¹âÄ»±»ÕÚµ²
  36          code char init_report_s3[]    = {0x82,0x08,0x23,0x00,0x03,0x00,0x00,0x00,0x3D,0xCE,0x83};   //3ºÅ¹âÄ»±»ÕÚµ²
  37          code char init_report_s4[]    = {0x82,0x08,0x23,0x00,0x04,0x00,0x00,0x00,0x1C,0x99,0x83};   //4ºÅ¹âÄ»±»ÕÚµ²
  38          code char init_report_s5[]    = {0x82,0x08,0x23,0x00,0x05,0x00,0x00,0x00,0xA7,0x85,0x83};   //1ºÅ¹âÄ»±»Çå³ý
  39          code char init_report_s6[]    = {0x82,0x08,0x23,0x00,0x06,0x00,0x00,0x00,0x6A,0xA0,0x83};   //2ºÅ¹âÄ»±»Çå³ý
  40          code char init_report_s7[]    = {0x82,0x08,0x23,0x00,0x07,0x00,0x00,0x00,0xD1,0xBC,0x83};   //3ºÅ¹âÄ»±»Çå³ý
  41          code char init_report_s8[]    = {0x82,0x08,0x23,0x00,0x08,0x00,0x00,0x00,0x28,0x0E,0x83};   //4ºÅ¹âÄ»±»Çå³ý
  42          code char init_report_s9[]    = {0x82,0x08,0x23,0x00,0x09,0x00,0x00,0x00,0x93,0x12,0x83};   //¿ªÃÅµ½Î»
  43          code char init_report_s10[]   = {0x82,0x08,0x23,0x00,0x0a,0x00,0x00,0x00,0x5E,0x37,0x83};   //¿ªÃÅ³¬Ê±
  44          code char init_report_s11[]   = {0x82,0x08,0x23,0x00,0x0b,0x00,0x00,0x00,0xE5,0x2B,0x83};   //¹ØÃÅµ½Î»
  45          code char init_report_s12[]   = {0x82,0x08,0x23,0x00,0x0c,0x00,0x00,0x00,0xC4,0x7C,0x83};   //¹ØÃÅ³¬Ê±
  46          code char init_report_s13[]   = {0x82,0x08,0x23,0x00,0x0d,0x00,0x00,0x00,0xA3,0x3A,0x83};  
  47          code char init_report_s14[]   = {0x82,0x08,0x23,0x00,0x0e,0x00,0x00,0x00,0x0A,0xF0,0x83};
  48          code char init_report_s15[]   = {0x82,0x08,0x23,0x00,0x0f,0x00,0x00,0x00,0x09,0x59,0x83};
  49          code char init_report_s17[]   = {0x82,0x08,0x23,0x00,0x11,0x01,0x00,0x00,0xA3,0x3A,0x83};  //´«ËÍ´øÕý×ª
  50          code char init_report_s18[]   = {0x82,0x08,0x23,0x00,0x11,0x02,0x00,0x00,0x0A,0xF0,0x83};  //´«ËÍ´ø·´×ª
  51          code char init_report_s19[]   = {0x82,0x08,0x23,0x00,0x11,0x03,0x00,0x00,0x09,0x59,0x83};  //´«ËÍ´øÍ£Ö¹
  52          code char init_report_s20[]   = {0x82,0x08,0x23,0x00,0x12,0x00,0x00,0x00,0x00,0x00,0x83};  //Í¼Êé³¬³¤
  53          code char init_report_s21[]   = {0x82,0x08,0x23,0x00,0x13,0x00,0x00,0x00,0x00,0x00,0x83};  //»¹Êé¿ÚÓÐÒìÎï
  54          code char init_report_s30[]   = {0x82,0x08,0x23,0x00,0xee,0x00,0x00,0x00,0x00,0x00,0x83};  //´«¸ÐÆ÷×´Ì¬²»Ã÷
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 2   

  55          
  56          code char init_report_s121[]  = {0x82,0x08,0x23,0x00,0x0c,0x01,0x00,0x00,0xC4,0x7C,0x83};  //½áÊø·ÅÊé 
  57          
  58          code char init_report_s131[]  = {0x82,0x08,0x23,0x00,0x0d,0x01,0x00,0x00,0xA3,0x3A,0x83};  // ÈëÊé³É¹¦
  59          code char init_report_s132[]  = {0x82,0x08,0x23,0x00,0x0d,0x02,0x00,0x00,0xC7,0xD5,0x83};  // ÈëÊéÊ§°Ü
  60          code char init_report_s133[]  = {0x82,0x08,0x23,0x00,0x0d,0x03,0x00,0x00,0xC7,0xD5,0x83};  // ÈëÊé³¬Ê±
  61          code char init_report_s141[]  = {0x82,0x08,0x23,0x00,0x0e,0x01,0x00,0x00,0x6E,0x1F,0x83};  // ÈëÏä³É¹¦
  62          code char init_report_s142[]  = {0x82,0x08,0x23,0x00,0x0e,0x02,0x00,0x00,0x0A,0xF0,0x83};  // ÈëÏäÊ§°Ü
  63          code char init_report_s151[]  = {0x82,0x08,0x23,0x00,0x0f,0x01,0x00,0x00,0x09,0x59,0x83};  // ÍËÊé³É¹¦
  64          code char init_report_s152[]  = {0x82,0x08,0x23,0x00,0x0f,0x02,0x00,0x00,0x51,0x28,0x83};  // ÍËÊéÊ§°Ü
  65          code char init_report_s16[]   = {0X82,0X08,0X23,0X00,0X10,0X00,0X00,0X00,0x00,0x00,0X83};  // ¸´Î»³É¹¦
  66          //×´Ì¬²éÑ¯·µ»Ø
  67          code char Re_che_state[]    = {0x82,0x08,0x24,0x00,0x00,0x00,0x00,0x00,0x21,0xf7,0x83};
  68          code char Re_state_ok[]     = {0x82,0x08,0x24,0x00,0x00,0x01,0x00,0x00,0x1f,0x66,0x83};
  69          /*code char Re_s1_erro[]      = {0x82,0x08,0x24,0x00,0x01,0x00,0x00,0x00,0x9a,0xeb,0x83};
  70          code char Re_s2_erro[]      = {0x82,0x08,0x24,0x00,0x02,0x00,0x00,0x00,0xb5,0x05,0x83};
  71          code char Re_s3_erro[]      = {0x82,0x08,0x24,0x00,0x03,0x00,0x00,0x00,0x0e,0xe9,0x83};
  72          code char Re_s4_erro[]      = {0x82,0x08,0x24,0x00,0x04,0x00,0x00,0x00,0x2f,0x4e,0x83};
  73          code char Re_s5_erro[]      = {0x82,0x08,0x24,0x00,0x05,0x00,0x00,0x00,0x94,0x52,0x83};
  74          code char Re_s6_erro[]      = {0x82,0x08,0x24,0x00,0x06,0x00,0x00,0x00,0x59,0x77,0x83};
  75          code char Re_s7_erro[]      = {0x82,0x08,0x24,0x00,0x07,0x00,0x00,0x00,0xe2,0x6b,0x83};
  76          code char Re_s8_erro[]      = {0x82,0x08,0x24,0x00,0x08,0x00,0x00,0x00,0x1b,0xd9,0x83};
  77          code char Re_s9_erro[]      = {0x82,0x08,0x24,0x00,0x09,0x00,0x00,0x00,0xa0,0xc5,0x83};
  78          code char Re_s10_erro[]     = {0x82,0x08,0x24,0x00,0x0a,0x00,0x00,0x00,0x6d,0xe0,0x83};
  79          code char Re_s11_erro[]     = {0x82,0x08,0x24,0x00,0x0b,0x00,0x00,0x00,0xd6,0xfc,0x83};
  80          code char Re_s12_erro[]     = {0x82,0x08,0x24,0x00,0x0c,0x00,0x00,0x00,0xf7,0xab,0x83};
  81          code char Re_s13_erro[]     = {0x82,0x08,0x24,0x00,0x0d,0x00,0x00,0x00,0x4c,0xb7,0x83};
  82          code char Re_s14_erro[]     = {0x82,0x08,0x24,0x00,0x0e,0x00,0x00,0x00,0x81,0x92,0x83};
  83          code char Re_s15_erro[]     = {0x82,0x08,0x24,0x00,0x0f,0x00,0x00,0x00,0x3a,0x8e,0x83};
  84          code char Re_s16_erro[]     = {0x82,0x08,0x24,0x00,0x10,0x00,0x00,0x00,0x62,0xff,0x83}; */
  85          
  86          unsigned char Re_data_erro[]    = {0x82,0x08,0x24,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x83};
  87          
  88          unsigned char bdata SystemFlag;
  89          sbit SysState = SystemFlag^0;
  90          sbit sys_timeout_flag = SystemFlag^1;
  91          sbit SafeFlag = SystemFlag^2;
  92          
  93          void prog_direct_running()                                 //Õý×ª
  94          {
  95   1        doorlock_c1 = control_off;
  96   1        doorlock_c2 = control_on;
  97   1      }
  98          void prog_Reverse_running()                         //·´×ª
  99          {
 100   1        doorlock_c1 = control_on;
 101   1        doorlock_c2 = control_off;
 102   1      }
 103          void prog_stop_running()                               //Í£Ö¹
 104          { 
 105   1        doorlock_c1 = control_off;
 106   1        doorlock_c2 = control_off;
 107   1        delay_1msx(100);
 108   1      //  book_stop_running_250tims = 2;
 109   1      //  while(book_stop_running_250tims) ;                     //Í£Ö¹ºó£¬ÔÝÍ£500ms£¬±ÜÃâ³öÏÖµã»÷Õý·´×°£¬ÔÝÍ£Ö®¼äÇÐ»»¹ý¿ì
             -ÎÊÌâËðÉËµç»ú
 110   1      }
 111          /*void Light_red_on()                                 //ºìÉ«Ö¸Ê¾µÆÁÁ£¬ÂÌÉ«Ö¸Ê¾µÆÃð
 112          {
 113            light_red     = control_on;
 114            light_green = control_off;
 115          }
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 3   

 116          
 117          void Light_green_on()                         //ÂÌÉ«Ö¸Ê¾µÆÁÁ£¬ºìÉ«Ö¸Ê¾µÆÃð
 118          {
 119            light_red     = control_off;
 120            light_green = control_on;
 121          }
 122          
 123          void Light_off()                              //ºìÉ«ÂÌÉ«Ö¸Ê¾µÆ¶¼Ãð
 124          {
 125            light_red     = control_off;
 126            light_green = control_off;
 127          }*/
 128          
 129          void Positive_Door_run()      //¿ªÃÅ
 130          {
 131   1      //    delay(800);                 //2012.11.28
 132   1          GND_1 = 0;
 133   1          V12_1 = 0;
 134   1          GND_2 = 1;
 135   1          V12_2 = 1;
 136   1      
 137   1      }
 138          
 139          void Negative_Door_run()       //¹ØÃÅ
 140          {
 141   1          GND_1 = 1;
 142   1          V12_1 = 1;
 143   1          GND_2 = 0;
 144   1          V12_2 = 0;
 145   1      }
 146          
 147          void Stop_Door_run()
 148          {
 149   1          GND_1 = 1;
 150   1          V12_1 = 1;
 151   1          GND_2 = 1;
 152   1          V12_2 = 1;
 153   1      }
 154            
 155          ////////////////////////////////////////////////////////////////////////
 156          //Ãû³Æ£ºuint CRC3(unsigned char *ptr, uchar  i_len)
 157          //¹¦ÄÜ£º¼ÆËãÖ¸¶¨Êý¾ÝÑ­»·ÈßÓàÐ£ÑéÂë
 158          //Èë¿Ú²ÎÊý£ºptr     Ö¸¶¨Êý¾Ý¿éÊ×µØÖ·
 159          //          i_len   Ö¸¶¨Êý¾Ý¿é³¤¶È
 160          //³ö¿Ú²ÎÊý£ºcrc     Ö¸¶¨Êý¾ÝµÄÐ£ÑéÂë
 161          //ÏµÍ³Ó°Ïì£ºÎÞ
 162          ///////////////////////////////////////////////////////////////////////
 163          uint CRC3(unsigned char *ptr, uchar  i_len)
 164          {
 165   1        uint CRC_POLYNOM = 0x8408;                        //polynome [Êý]¶àÏîÊ½(µÄ)
 166   1        uint CRC_PRESET  = 0xFFFF;
 167   1        uint crc = CRC_PRESET;
 168   1        uchar i,j;
 169   1        for(i=0;i< i_len;i++)
 170   1        {
 171   2          crc^=*ptr;                                          // ^ Òì»ò²Ù×÷ crc = crc ^ (*ptr) = 0xFFFF ^(*ptr)
 172   2          ptr++;
 173   2          for(j=0;j< 8; j++)
 174   2          {
 175   3            if((crc&0x0001)>0)
 176   3              crc = (crc>>1)^CRC_POLYNOM;
 177   3            else
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 4   

 178   3              crc = (crc>>1);
 179   3          }             
 180   2        }
 181   1        return (crc);
 182   1      }
 183                                                //²ÉÓÃÊ±¼äÆ¬·½Ê½Ä£Äâ¶àÏß³Ì´¦Àí£¬
 184                                              //¿ÉÒÔÔÚ±ÜÃâÖ´ÐÐÊ±¼ä½Ï³¤µÄÃüÁî¶¯×÷ÆÚ¼äÏàÓ¦ÏµÍ³ÃüÁî£¬¿ÉÒÔ±ÜÃâÉÏÎ»»ú´ô»ú
 185          void SystermProcess(void)
 186          {
 187   1          uchar flag = 0;
 188   1          switch(CURRENT_FATHER_PROCESS)
 189   1        {
 190   2            #region ¸´Î»²Ù×÷
*** WARNING C315 IN LINE 190 OF equipment.c: unknown #directive 'region'
 191   2        
 192   2          case PROCESS_Command_reset :                  
 193   2            switch(CURRENT_SON_PROCESS)
 194   2            {
 195   3              case  PROCESS_Command_reset_Step0:
 196   3                  send_string_com(Re_reset);            //ÉÏ±¨¸´Î»ÃüÁî½ÓÊÕµ½
 197   3                  prog_direct_running();              //´«ËÍ´øÕý×ª
 198   3                  
 199   3                  //Positive_Door_run();              //¿ªÃÅ  £¬µç»úºÍÈë¿Ú´¦½Ó½ü¿ª¹ØÁ´½ÓÏà·´  £¬2013.5.7 £¬Ñîº£·å
 200   3                  prog_reset_250times = 4*4;            //µç»ú×ª¶¯Ê±¼ä5Ãë
 201   3                  door_running_250times = 4*4;          //¹ØÃÅÊ±¼ä½çÏÞ3Ãë
 202   3                  CURRENT_SON_PROCESS   = PROCESS_Command_reset_Step1;
 203   3                  SysModle = SystermBussy;
 204   3                  //break;
 205   3              case  PROCESS_Command_reset_Step1:
 206   3                         
 207   3      //            if((CloseStopDoorRun == 0)||(!door_running_250times))     //ÃÅµ½Î»Í£Ö¹9.22
 208   3      //            {
 209   3      //               Stop_Door_run();
 210   3      //            // send_string_com(init_report_s9);      //ÉÏ±¨¿ªÃÅµ½Î»
 211   3      //            }
 212   3      
 213   3                  if(prog_reset_250times<8)  
 214   3                  {           
 215   4                    prog_Reverse_running();
 216   4                    if(prog_reset_250times==0)
 217   4                    { 
 218   5                      prog_stop_running();
 219   5                      prog_reset_250times = 4*3;  
 220   5                      door_NErunning_250times = 4*5;
 221   5                      //Negative_Door_run();
 222   5                      CURRENT_SON_PROCESS = PROCESS_Command_reset_Step2;
 223   5                    }                 
 224   4                  } 
 225   3                  
 226   3                  break;
 227   3              case  PROCESS_Command_reset_Step2:
 228   3                  //Negative_Door_run();                                                                 //¿ªÃÅÊ±¼ä½çÏÞ5Ãë
 229   3      //            while((OpenStopDoorRun == 0))//||(!door_NErunning_250times))         //ÃÅµ½Î»Í£Ö¹9.22
 230   3      //              {
 231   3      //                 Stop_Door_run();
 232   3      //              // send_string_com(init_report_s11);               //ÉÏ±¨¹ØÃÅµ½Î»
 233   3      //               send_string_com(init_report_s16);             //ÉÏ±¨¸´Î»Íê±Ï£¬Éè±¸´¦ÓÚ¿ÕÏÐ×´Ì¬
 234   3      //               CURRENT_SON_PROCESS = PROCESS_Command_reset_Step3;
 235   3      //               SysModle = SystermIdle;
 236   3      //               break;
 237   3      //            }
 238   3                    send_string_com(init_report_s16);            //ÉÏ±¨¸´Î»Íê±Ï£¬Éè±¸´¦ÓÚ¿ÕÏÐ×´Ì¬
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 5   

 239   3                    CURRENT_SON_PROCESS = PROCESS_Command_reset_Step3;
 240   3                    SysModle = SystermIdle;
 241   3                     break;
 242   3      //            if((!EntrySensor )||(!SavftyEdag))  //Èç¹ûÔÚ¸Ã´¦ÅÐ¶ÏÓÐÕÚµ²Îï¾ÍÖ»·¢ÐÅÏ¢¸æÖª?           
 243   3      //            {
 244   3      //              Stop_Door_run();
 245   3      //              delay(50);
 246   3      //              while(CloseStopDoorRun!=0)
 247   3      //                {
 248   3      //                Positive_Door_run();
 249   3      //                  }
 250   3      //              
 251   3      //              Stop_Door_run();
 252   3      //              delay(50);
 253   3      // //                            Negative_Door_run();
 254   3      // //             break;
 255   3      //             }
 256   3      //             else if(EntrySensor&&SavftyEdag)     //ÈëÊé¿ÚÎÞÕÏ°­£¬¹ØÃÅ
 257   3      //             {
 258   3      //              Negative_Door_run();
 259   3      //             } 
 260   3                  
 261   3                break;
 262   3                
 263   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; //¸´Î»Íê±Ï£¬ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬
 264   3                  break;
 265   3            }
 266   2            break;
 267   2            #endregion
*** WARNING C315 IN LINE 267 OF equipment.c: unknown #directive 'endregion'
 268   2          
 269   2            
 270   2            #region ´«ËÍ´øÕý×ª
*** WARNING C315 IN LINE 270 OF equipment.c: unknown #directive 'region'
 271   2          case PROCESS_Command_prog_direct :                  
 272   2            switch(CURRENT_SON_PROCESS)
 273   2            {
 274   3              case  PROCESS_Command_prog_direct_Step0:
 275   3                  send_string_com(Re_prog_direct);          //ÉÏ±¨´«ËÍ´øÕý×ªÖ¸ÁîÊÕµ½
 276   3                  prog_direct_running();              //´«ËÍ´øÕý×ª
 277   3                  send_string_com(init_report_s17);         //ÉÏ±¨´«ËÍ´øÕý×ª
 278   3                  prog_reset_250times = 4*60;           //µç»ú×ª¶¯Ê±¼ä60Ãë
 279   3                  CURRENT_SON_PROCESS   = PROCESS_Command_prog_direct_Step1;
 280   3                  SysModle = SystermBussy;
 281   3                  break;
 282   3              case  PROCESS_Command_prog_direct_Step1:                   
 283   3                  if(prog_reset_250times == 0)  //  || (!door_running_250times))    
 284   3                  {
 285   4                     prog_stop_running();
 286   4                   CURRENT_SON_PROCESS  = PROCESS_Command_prog_direct_Step2;
 287   4                   break;
 288   4                  }
 289   3                  else
 290   3                     CURRENT_SON_PROCESS  = PROCESS_Command_prog_direct_Step2;
 291   3                  break;
 292   3              case  PROCESS_Command_prog_direct_Step2:
 293   3                     SysModle = SystermIdle;  
 294   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; //ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬          
 295   3                  break;
 296   3            }
 297   2            break;
 298   2            #endregion
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 6   

*** WARNING C315 IN LINE 298 OF equipment.c: unknown #directive 'endregion'
 299   2          
 300   2            
 301   2            #region ´«ËÍ´ø·´×ª
*** WARNING C315 IN LINE 301 OF equipment.c: unknown #directive 'region'
 302   2            
 303   2          case PROCESS_Command_prog_reverse :                   
 304   2            switch(CURRENT_SON_PROCESS)
 305   2            {
 306   3              case  PROCESS_Command_prog_reverse_Step0:
 307   3                  send_string_com(Re_prog_reverse);         //ÉÏ±¨´«ËÍ´øÕý×ªÖ¸ÁîÊÕµ½
 308   3                  prog_Reverse_running();             //´«ËÍ´ø·´×ª
 309   3                  send_string_com(init_report_s18);         //ÉÏ±¨´«ËÍ´ø·´×ª
 310   3                  prog_reset_250times = 4*60;           //µç»ú×ª¶¯Ê±¼ä60Ãë
 311   3                  CURRENT_SON_PROCESS   = PROCESS_Command_prog_reverse_Step1;
 312   3                  SysModle = SystermBussy;
 313   3                  break;
 314   3              case  PROCESS_Command_prog_reverse_Step1:                  
 315   3                  if(prog_reset_250times == 0)  //  || (!door_running_250times))    
 316   3                  {
 317   4                     prog_stop_running();
 318   4                   CURRENT_SON_PROCESS  = PROCESS_Command_prog_reverse_Step2;
 319   4                   break;
 320   4                  }
 321   3                  else
 322   3                     CURRENT_SON_PROCESS  = PROCESS_Command_prog_reverse_Step2;
 323   3                  break;
 324   3              case  PROCESS_Command_prog_reverse_Step2:
 325   3                     SysModle = SystermIdle;  
 326   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; //ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬          
 327   3                  break;
 328   3            }
 329   2            break;
 330   2            #endregion
*** WARNING C315 IN LINE 330 OF equipment.c: unknown #directive 'endregion'
 331   2            
 332   2            
 333   2      
 334   2           
 335   2            #region ´«ËÍ´øÍ£Ö¹
*** WARNING C315 IN LINE 335 OF equipment.c: unknown #directive 'region'
 336   2          case PROCESS_Command_prog_stop :                  
 337   2            switch(CURRENT_SON_PROCESS)
 338   2            {
 339   3              case  PROCESS_Command_prog_stop_Step0:
 340   3                  send_string_com(Re_prog_stop);          //ÉÏ±¨´«ËÍ´øÕý×ªÖ¸ÁîÊÕµ½
 341   3                  SysModle = SystermBussy;
 342   3                  prog_stop_running();
 343   3                  send_string_com(init_report_s19);         //ÉÏ±¨´«ËÍ´øÍ£Ö¹
 344   3                  SysModle = SystermIdle;             //´«ËÍ´ø·´×ª  
 345   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; //ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬          
 346   3                  break;
 347   3            }
 348   2            break;
 349   2            #endregion
*** WARNING C315 IN LINE 349 OF equipment.c: unknown #directive 'endregion'
 350   2            
 351   2            
 352   2            #region ÈëÊé²Ù×÷
*** WARNING C315 IN LINE 352 OF equipment.c: unknown #directive 'region'
 353   2          case PROCESS_Command_book_in:
 354   2            switch(CURRENT_SON_PROCESS)
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 7   

 355   2            {  
 356   3              case  PROCESS_Command_book_in_Step0:
 357   3                  send_string_com(Re_book_in);
 358   3                  door_running_250times = 4*4;          //¹ØÃÅ½çÏÞÎª3Ãë 2013.5.7
 359   3              //    Positive_Door_run();
 360   3                  BoxSensor_on_times = 0;         //ÈëÏä´«¸ÐÆ÷³õÊ¼»¯
 361   3                  SysModle = SystermBussy;
 362   3      //            conveyor_run = 0;           //´«ËÍ´øÆô¶¯ÐÅºÅ
 363   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step1;
 364   3                  break;
 365   3      
 366   3              case  PROCESS_Command_book_in_Step1:
 367   3                   door_NErunning_250times=4*60;
 368   3                             book_in_Running_250times = 4*10;       //ÈëÊé´«ËÍ´øÕý´«5s  ¸ÄÎª6s 
 369   3      //             while(CloseStopDoorRun != 0)//||door_running_250times)    //ÃÅµ½Î»Í£Ö¹9.22
 370   3      //                        {
 371   3      //                            Positive_Door_run();
 372   3      //                        }
 373   3                             Stop_Door_run();
 374   3                             send_string_com(init_report_s9);                     //ÉÏ±¨¿ªÃÅµ½Î»            
 375   3                             CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step2;
 376   3                   break;
 377   3      
 378   3              case  PROCESS_Command_book_in_Step2:
 379   3                             if((ReadSensor==0) && door_NErunning_250times )                    //Èç¹û¼ì²éµ½ÓÐÎïÌå·ÅÈë 
 380   3                             {                                           
 381   4                                 //QuerySysDeviceState();
 382   4                                 SysState=1;
 383   4                                 door_NErunning_250times=4*60;
 384   4                                 book_in_Running_250times = 4*8;
 385   4                                 prog_direct_running();                                               //´«ËÍ´øÕý
             -×ª
 386   4                                 CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step3;
 387   4                                 break;
 388   4                             }
 389   3                             else if(door_NErunning_250times==0)
 390   3                             {                                               
 391   4                                           SysState=0;
 392   4                                  CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step6;
 393   4                                           break;
 394   4                             }
 395   3                             break;
 396   3              case  PROCESS_Command_book_in_Step3:
 397   3                             if(book_in_Running_250times) 
 398   3                             {
 399   4                                 if((BoxSensor==1)&&(ReadSensor==1))  
 400   4                                 {
 401   5                            //     CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step2;
 402   5                            //     Negative_Door_run();
 403   5                                    break;
 404   5                                 }
 405   4                                 else if((BoxSensor==1)&&(ReadSensor==0))
 406   4                                 {          
 407   5                          //       CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 408   5                                   
 409   5                                   
 410   5                                    break;
 411   5                                 }
 412   4                                 else if((BoxSensor_on_times>5)&&(ReadSensor==1))    //2014.12.29 ·À¶¶´¦Àí
 413   4                                 {          
 414   5                                     prog_stop_running();
 415   5                                     CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step4;
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 8   

 416   5                                     //Negative_Door_run();
 417   5                                     door_NErunning_250times=4*10;
 418   5                                     break;
 419   5                                 }
 420   4                                 else if((BoxSensor==0)&&(ReadSensor==0))
 421   4                                 {
 422   5                                     prog_stop_running();
 423   5                                     CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 424   5                                     break;
 425   5                                 }
 426   4                                 break;
 427   4                           }
 428   3              
 429   3                            else if(book_in_Running_250times==0)        //ÈëÊé³¬Ê±
 430   3                           {
 431   4                               SysState=0;
 432   4                               prog_stop_running();
 433   4                               if((BoxSensor==1)&&(ReadSensor==1))  
 434   4                               {
 435   5                                   send_string_com(init_report_s133);   // 2014.8.11 ÉÏ±¨ÈëÊé³¬Ê± Ë¢ÐÂ½çÃæ
 436   5                                   CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step2;
 437   5                                   break;
 438   5                               }
 439   4                               else if((BoxSensor==1)&&(ReadSensor==0))
 440   4                               {          
 441   5                        //       CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 442   5                                    break;
 443   5                               }
 444   4                               else if((BoxSensor==0)&&(ReadSensor==1))
 445   4                               {          
 446   5                                   CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step4;
 447   5                                   Negative_Door_run();
 448   5                                   door_NErunning_250times=4*10;
 449   5                                   break;
 450   5                               }
 451   4                              else if((BoxSensor==0)&&(ReadSensor==0))
 452   4                              {
 453   5                                    CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 454   5                                    break;
 455   5                              }
 456   4                              break;
 457   4                         }
 458   3                         else
 459   3                            break;                                   
 460   3                         break;
 461   3                              
 462   3               case  PROCESS_Command_book_in_Step4: 
 463   3      
 464   3      //                if((OpenStopDoorRun==0))//||(!door_NErunning_250times))
 465   3      //            {
 466   3      //                Stop_Door_run();
 467   3      //              send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 468   3      //                CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 469   3      //              break;            
 470   3      //            }
 471   3      //            if(((EntrySensor==0 )||(SavftyEdag==0)||(ReadSensor==0))&& door_NErunning_250times)   //·À¼ÐÊÖ
 472   3      //            {
 473   3      //              Stop_Door_run();
 474   3      //              send_string_com(init_report_s21);    //ÉÏ±¨»¹Êé¿ÚÓÐÒìÎï
 475   3      //              delay(50);
 476   3      //              while(CloseStopDoorRun!=0)
 477   3      //              {
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 9   

 478   3      //                Positive_Door_run();
 479   3      //                }             
 480   3      //              Stop_Door_run();
 481   3      //              delay(50);
 482   3      //              break;
 483   3      //              }
 484   3      //            else if(EntrySensor&&SavftyEdag&&ReadSensor&&door_NErunning_250times)     //ÈëÊé¿ÚÎÞÕÏ°­£¬¹ØÃÅ
 485   3      //            {
 486   3      //              Negative_Door_run();
 487   3      //              break;
 488   3      //            }
 489   3      //            else if(door_NErunning_250times==0)
 490   3      //            {
 491   3      //              Stop_Door_run();
 492   3      //              delay(10);
 493   3      //              CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 494   3      //              send_string_com(init_report_s12);      //ÉÏ±¨¹ØÃÅÊ§°Ü
 495   3      //              break;
 496   3      //            } 
 497   3                  send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 498   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step5;
 499   3                  break;
 500   3                  
 501   3                case  PROCESS_Command_book_in_Step5:           
 502   3                  if(ReadSensor==0)         //Èç¹ûÍ¼ÊéÒÑ¾­½øÈë£¬µ«ÊÇ¶Á¿¨Æ÷Ç°¹âµç¼ì²âµ½Í¼Êé£¬ÈÏÎªÍ¼Êé³¬³¤»òÁ¬Ðø·ÅÊé
 503   3                  {
 504   4                    Stop_Door_run();
 505   4                    BoxSensor_on_times = 0;           //Éè¶¨ÎªÈëÊéÊ§°Ü×´Ì¬
 506   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 507   4                    send_string_com(init_report_s20);    //Ö÷¶¯ÉÏ±¨Í¼Êé³¬³¤
 508   4                    break;
 509   4                  }
 510   3                    
 511   3                  else //if(BoxSensor_on_times > 0)                 
 512   3                  {
 513   4                    
 514   4                    
 515   4                    RevolEnable = 0;
 516   4                  
 517   4                  
 518   4                  
 519   4                  
 520   4                    send_string_com(init_report_s131);      //ÈëÊé³É¹¦
 521   4                    send_string_com(init_report_s131);
 522   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 523   4                    
 524   4                    //prog_direct_running();
 525   4                    
 526   4                    //door_running_250times = 4*4;  
 527   4                    
 528   4                    break;
 529   4                  }
 530   3      //            else
 531   3      //            {               
 532   3      //              send_string_com(init_report_s132);            //2014.12.25   Ôö¼Ó
 533   3      //              CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 534   3      //              break;
 535   3      //            }
 536   3                /*  else                      //Ô­³ÌÐòÈ¡ÏûÁË³¬³¤Í¼Êé¼ì²â£¬ÉÏ±¨ÈëÊéÊ§°Ü
 537   3                  {   
 538   3                    send_string_com(init_report_s132);      //ÈëÊéÊ§°Ü
 539   3                  } */
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 10  

 540   3                case  PROCESS_Command_book_in_Step6:
 541   3      //            if((OpenStopDoorRun==0))//||(!door_NErunning_250times))
 542   3      //            {
 543   3      //                Stop_Door_run();
 544   3      //              send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 545   3      //                CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 546   3      //              break;            
 547   3      //            }
 548   3      //            if((EntrySensor==0 )||(SavftyEdag==0)||(ReadSensor==0))   //·À¼ÐÊÖ
 549   3      //            {
 550   3      //              Stop_Door_run();
 551   3      //              delay(50);
 552   3      //              while(CloseStopDoorRun!=0)
 553   3      //              {
 554   3      //                Positive_Door_run();
 555   3      //                }             
 556   3      //              Stop_Door_run();
 557   3      //              delay(50);
 558   3      // //                            Negative_Door_run();         //²»¹ØÃÅ
 559   3      //              break;
 560   3      //              }
 561   3      //            else if(EntrySensor&&SavftyEdag&&ReadSensor)      //ÈëÊé¿ÚÎÞÕÏ°­£¬¹ØÃÅ
 562   3      //            {
 563   3      //              Negative_Door_run();
 564   3      //              break;
 565   3      //            } 
 566   3                  send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 567   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_in_Step7;
 568   3                  break;
 569   3      
 570   3                case  PROCESS_Command_book_in_Step7:
 571   3          
 572   3                  SysState=0;
 573   3                     
 574   3                  SysModle = SystermIdle;
 575   3                default:CURRENT_FATHER_PROCESS = PROCESS_Command_Idle;  //ÈëÊéÍê±Ï£¬ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬
 576   3               break;
 577   3            }
 578   2            break;
 579   2      #endregion 
*** WARNING C315 IN LINE 579 OF equipment.c: unknown #directive 'endregion'
 580   2            
 581   2            
 582   2            #region ½áÊøÃüÁî
*** WARNING C315 IN LINE 582 OF equipment.c: unknown #directive 'region'
 583   2          case PROCESS_Command_End://½áÊøÖ¸Áî   
 584   2                switch(CURRENT_SON_PROCESS)
 585   2                {
 586   3                        case  PROCESS_Command_End_Step0:
 587   3                                    send_string_com(Re_close_drop);
 588   3                                    door_NErunning_250times = 4*4;
 589   3                                  book_out_Running_250times = 4*2;
 590   3                              //      Negative_Door_run();
 591   3                           //2014.8.1   prog_direct_running();
 592   3                                    CURRENT_SON_PROCESS = PROCESS_Command_End_Step1;
 593   3                              SysModle = SystermBussy;
 594   3      //                  conveyor_run = 1;           //´«ËÍ´øÍ£Ö¹ÐÅºÅ
 595   3                            break;
 596   3                      
 597   3                        case  PROCESS_Command_End_Step1:
 598   3      //                        if((OpenStopDoorRun == 0))// ||(!door_NErunning_250times))    
 599   3      //                        {
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 11  

 600   3      //                            Stop_Door_run();
 601   3      //                //          if(!door_NErunning_250times)         //È¥µôÊ±ÏÞÅÐ¶Ï
 602   3      //                //          {
 603   3      //                            prog_stop_running();
 604   3      //                            send_string_com(init_report_s11);        //¹ØÃÅµ½Î»ÉÏ±¨
 605   3      //                            CURRENT_SON_PROCESS = PROCESS_Command_End_Step2;
 606   3      //                //          }
 607   3      //                        }
 608   3      //                        if((EntrySensor==0 )||(SavftyEdag==0)||(ReadSensor==0)||(door_NErunning_250times==0))
             -    
 609   3      //                        {
 610   3      //                            Stop_Door_run();
 611   3      //                  //2014.8.1          prog_stop_running();
 612   3      //                            delay(50);
 613   3      //                            while(CloseStopDoorRun!=0)
 614   3      //                            {
 615   3      //                              Positive_Door_run();
 616   3      //                            }                 
 617   3      //                            Stop_Door_run();
 618   3      //                       //   delay(50);
 619   3      //                            delay_200msx(10);
 620   3      //                            door_NErunning_250times=4*4;                                  
 621   3      //                        }
 622   3      //                        else if(EntrySensor && SavftyEdag && ReadSensor)
 623   3      //                        {
 624   3      //                            Negative_Door_run();
 625   3      //                        }
 626   3                              delay_200msx(5);
 627   3                              prog_stop_running();
 628   3                              send_string_com(init_report_s11);        //¹ØÃÅµ½Î»ÉÏ±¨
 629   3                              CURRENT_SON_PROCESS = PROCESS_Command_End_Step2;
 630   3                              break;
 631   3      
 632   3                        case PROCESS_Command_End_Step2:             
 633   3                            default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle; 
 634   3                  break;
 635   3                      
 636   3                }
 637   2                break;
 638   2            #endregion
*** WARNING C315 IN LINE 638 OF equipment.c: unknown #directive 'endregion'
 639   2            
 640   2            
 641   2            
 642   2            #region ÍËÊé²Ù×÷
*** WARNING C315 IN LINE 642 OF equipment.c: unknown #directive 'region'
 643   2            
 644   2          case PROCESS_Command_book_out:
 645   2            switch(CURRENT_SON_PROCESS)
 646   2            {
 647   3              case  PROCESS_Command_book_out_Step0:
 648   3                  send_string_com(Re_book_out);         //ÍËÊéÃüÁî·´À¡
 649   3              case  PROCESS_Command_book_out_StepF:    
 650   3                  book_out_Running_250times = 4*4;        //ÍËÊé´«ËÍ´øÕý´«5S
 651   3                              door_NErunning_250times   = 4*4;          //¿ªÃÅÊ±¼ä½çÏÞ3Ãë
 652   3              //      Positive_Door_run();                 //¿ªÃÅ    2013.5.7 
 653   3                             
 654   3                  prog_Reverse_running();
 655   3                  ReadSensor_on_times = 0;
 656   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step1;
 657   3                  ReadSensor_on_timeout_250times = 4*60;      //ÉèÖÃµÈ´ýÍËÊéºóµÈ´ý¶ÁÕßÈ¡ÊéÊ±¼äÎª60Ãë
 658   3                  break;
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 12  

 659   3              case  PROCESS_Command_book_out_Step1:
 660   3      //            if(CloseStopDoorRun == 0)//||!door_NErunning_250times)     //²»¼ÓÈë³¬Ê±ÅÐ¶Ï
 661   3      //              {
 662   3      //                Stop_Door_run();
 663   3      //            } 
 664   3                  if(book_out_Running_250times)
 665   3                  {
 666   4                    if(ReadSensor_on_times  >= 10)        //¼ì²é¶Á¿¨Ç°¹âµçÓÐÐ§ÐÅºÅ10msÂË²¨
 667   4                    {
 668   5                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step2;
 669   5                    }
 670   4                  }
 671   3                  else
 672   3                  {
 673   4                    prog_stop_running();
 674   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step2; 
 675   4                  }
 676   3                  break;
 677   3              case  PROCESS_Command_book_out_Step2:
 678   3              //    book_out_Running_250times_bake = book_out_Running_250times;
 679   3                  if(book_out_Running_250times > 0)       //Èç¹ûÊéÍËµ½¶Á¿¨Ç°¹â£¬Ôò¼ÌÐø1sÑÓÊ±
 680   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step9;         //ÍËÊéÑÓÊ±Ê±¼ä500ºÁÃë
 681   3                  else
 682   3                  {
 683   4                      send_string_com(init_report_s151);
 684   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_StepA;      //·µ»Ø»¹ÊéÁ÷³Ì
 685   4                      SysModle = SystermIdle;
 686   4                  } 
 687   3                  break;
 688   3              case  PROCESS_Command_book_out_Step3:
 689   3                    if(!book_out_Running_250times) 
 690   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step4; 
 691   3                  break;
 692   3              case  PROCESS_Command_book_out_Step4:
 693   3                    prog_stop_running();    
 694   3                    QuerySysDeviceState();                //ÉÏ±¨ÊéÒÑ¾­µ½Èë¿Ú
 695   3                    ReadSensor_on_timeout_250times = 4*15;      //ÍË³öµÄµÚÒ»±¾ÊéÈ¡×ß³¬Ê±Ê±ÏÞ
 696   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step5; 
 697   3                    break;
 698   3              case  PROCESS_Command_book_out_Step5:
 699   3                    if(ReadSensor_on_timeout_250times)         //Èç¹ûµÈ´ý¶ÁÕßÈ¡×ßµÚÒ»±¾ÊéÎ´³¬Ê±£¬¼ÌÐøµÈ´ý
 700   3                    {
 701   4                     if(ReadSensor == 1)           //¶ÁÕßÈ¡×ßµÚÒ»±¾Êé£¬¼ÌÐøÍËµÚ¶þ±¾Êé
 702   4                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step6; 
 703   4                    }
 704   3                    else
 705   3                    {
 706   4                     CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step9;
 707   4                     door_NErunning_250times = 4*30;
 708   4                //     ReadSensor_on_timeout_250times = 4*25;           
 709   4                    }
 710   3                    break;
 711   3              case  PROCESS_Command_book_out_Step6:
 712   3                    prog_Reverse_running();       //´«ËÍ´ø·´×ª
 713   3                    ReadSensor_on_times = 0;
 714   3                    book_out_Running_250times = 4*3;    //book_out_Running_250times_bake;
 715   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step7;
 716   3                    break;
 717   3              case  PROCESS_Command_book_out_Step7:
 718   3                    if(book_out_Running_250times)  
 719   3                    {
 720   4                     if(ReadSensor_on_times   >= 200)         //¼ì²é¶Á¿¨Ç°¹âµçÓÐÐ§ÐÅºÅ10msÂË²¨
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 13  

 721   4                     {
 722   5                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step8;
 723   5                      if(book_out_Running_250times > 0)     //Èç¹ûÊéÍËµ½¶Á¿¨Ç°¹â£¬Ôò¼ÌÐø1sÑÓÊ±
 724   5                      book_out_Running_250times = 0;      //ÍËÊéÑÓÊ±Ê±¼ä500ºÁÃë
 725   5                     }      
 726   4                    }
 727   3                    else
 728   3                    {
 729   4                       CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step8;
 730   4                    }           
 731   3                    break;
 732   3              case  PROCESS_Command_book_out_Step8:
 733   3                  
 734   3                    if(!book_out_Running_250times)
 735   3                    {
 736   4                     CURRENT_SON_PROCESS = PROCESS_Command_book_out_Step9;
 737   4                     ReadSensor_on_timeout_250times = 4*40;
 738   4                     door_NErunning_250times = 4*30;
 739   4                     prog_stop_running();           
 740   4                    }
 741   3                    break;
 742   3              case  PROCESS_Command_book_out_Step9:
 743   3                  if(book_out_Running_250times==0)
 744   3                    prog_stop_running();
 745   3                    if((ReadSensor_on_times)&&(ReadSensor_on_timeout_250times))   
 746   3                    //Èç¹ûµÚ¶þ±¾ÊéÍËµ½Èë¿Ú»òÍË³öµÈ´ý60ÃëÈ¡Êé³¬Ê±£¬±¨³É¹¦
 747   3                    {
 748   4                      break;
 749   4                    }
 750   3                    else if((ReadSensor_on_times)&&(ReadSensor_on_timeout_250times==0))
 751   3                  {
 752   4                    if(door_NErunning_250times)
 753   4                    {
 754   5                        prog_Reverse_running();
 755   5                    }
 756   4                    else
 757   4                        prog_stop_running();
 758   4                    break;
 759   4                  }
 760   3                  else if((ReadSensor_on_times==0)&&(ReadSensor_on_timeout_250times))
 761   3                  {             
 762   4                    prog_stop_running();
 763   4                    send_string_com(init_report_s151);      //ÉÏ±¨ÍËÊé³É¹¦
 764   4                  }
 765   3                  else if((ReadSensor_on_times==0)&&(ReadSensor_on_timeout_250times==0))
 766   3                  {
 767   4                      CURRENT_SON_PROCESS = PROCESS_Command_book_out_StepB;    //¹ØÃÅ
 768   4                    prog_stop_running();
 769   4                    door_NErunning_250times = 4*4;
 770   4                    break;
 771   4                  }
 772   3                  if(sys_timeout_flag)
 773   3                  {
 774   4                    sys_timeout_flag=0;
 775   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_out_StepB;
 776   4                    break;
 777   4                  }
 778   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_out_StepA;      //·µ»Ø»¹ÊéÁ÷³Ì
 779   3                  SysModle = SystermIdle; 
 780   3                  
 781   3              case  PROCESS_Command_book_out_StepA:       
 782   3                      CURRENT_FATHER_PROCESS=PROCESS_Command_book_in;
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 14  

 783   3                      CURRENT_SON_PROCESS=PROCESS_Command_book_in_Step0;
 784   3                  break;          
 785   3              //default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle;  //ÍËÊéÍê±Ï£¬ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬
 786   3              case  PROCESS_Command_book_out_StepB:
 787   3      //                if((OpenStopDoorRun==0))//||(!door_NErunning_250times))
 788   3      //                {
 789   3      //                    Stop_Door_run();
 790   3      //            //    SysModle = SystermIdle;
 791   3      //                prog_stop_running();
 792   3      //                  send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 793   3      //                CURRENT_SON_PROCESS=PROCESS_Command_book_out_StepC;
 794   3      //                    break;            
 795   3      //                }
 796   3      //                if((EntrySensor==0 )||(SavftyEdag==0)||(ReadSensor==0)||(door_NErunning_250times==0))   //·À¼
             -ÐÊÖ
 797   3      //                {
 798   3      //                  Stop_Door_run();
 799   3      //                  delay(50);
 800   3      //                  while(CloseStopDoorRun!=0)
 801   3      //                  {
 802   3      //                    Positive_Door_run();
 803   3      //                    }             
 804   3      //                  Stop_Door_run();
 805   3      //                  delay_200msx(10);
 806   3      //                door_NErunning_250times = 4*4;
 807   3      //                  break;
 808   3      //                  }
 809   3      //                else if(EntrySensor&&SavftyEdag&&ReadSensor)      //ÈëÊé¿ÚÎÞÕÏ°­£¬¹ØÃÅ
 810   3      //                {
 811   3      //                  Negative_Door_run();
 812   3      //                  break;
 813   3      //                }
 814   3                    if(ReadSensor_on_times >= 100)
 815   3                    {             
 816   4                        prog_stop_running();
 817   4                        send_string_com(init_report_s11);          //ÉÏ±¨¹ØÃÅµ½Î»
 818   4                        CURRENT_SON_PROCESS=PROCESS_Command_book_out_StepC;
 819   4                        break;
 820   4                    }
 821   3                  break;
 822   3              case  PROCESS_Command_book_out_StepC:
 823   3                      SysModle = SystermIdle;
 824   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle;
 825   3                    break;
 826   3            }
 827   2            break;
 828   2            #endregion
*** WARNING C315 IN LINE 828 OF equipment.c: unknown #directive 'endregion'
 829   2            
 830   2            
 831   2            
 832   2            #region ÈëÏä²Ù×÷
*** WARNING C315 IN LINE 832 OF equipment.c: unknown #directive 'region'
 833   2          case PROCESS_Command_book_drop:       
 834   2            switch(CURRENT_SON_PROCESS)
 835   2            {
 836   3              case    PROCESS_Command_book_drop_Step0:
 837   3      //          while(HeigntSensor==0)
 838   3      //          {
 839   3      //               ;
 840   3      //          }
 841   3      
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 15  

 842   3                    //conveyor_run=0;
 843   3                     V12_2=0;    //Æô¶¯Æ¤´ø
 844   3                     delay(1500);
 845   3                     V12_2=1;
 846   3                  book_drop_Running_250times = 4*4;
 847   3                  send_string_com(Re_book_drop);
 848   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step1;
 849   3                  
 850   3                  
 851   3                  prog_book_drop_Return =  0x00;
 852   3                  //conveyor_run = 0;       //Æô¶¯Á÷Ë®Ïß
 853   3                  break;
 854   3              case    PROCESS_Command_book_drop_Step1:
 855   3                  if((!prog_book_drop_Return)&&(book_drop_Running_250times))
 856   3                  {
 857   4                    if(CURRENT_GRANDSON_PROCESS == CURRENT_GRANDSON_PROCESS_step0)
 858   4                    {
 859   5                      prog_book_drop_kind = 0;
 860   5                      if(BoxSensor_on_times != 0)
 861   5                        prog_book_drop_kind |=BoxSignalON;
 862   5                      if(ReadSensor_on_times != 0)
 863   5                        prog_book_drop_kind |=ReaderSignalON;
 864   5      
 865   5                    }    
 866   4                    switch(prog_book_drop_kind) 
 867   4                    {   
 868   5                      case ReaderSignalOFF|BoxSignalON:
 869   5                           switch(CURRENT_GRANDSON_PROCESS)
 870   5                           {
 871   6                             case CURRENT_GRANDSON_PROCESS_step0:
 872   6                                book_drop_Running_250times = 4*4;   //ÈëÊé´«ËÍ´øÕý´«4S
 873   6                                prog_direct_running();
 874   6                                CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step1;
 875   6                              break;
 876   6                             case CURRENT_GRANDSON_PROCESS_step1:
 877   6                                if(book_drop_Running_250times)
 878   6                                {
 879   7                                  if(BoxSensor_on_times == 0)
 880   7                                  {
 881   8                                    prog_book_drop_Return = 1;
 882   8                                    CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;
 883   8                                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step2;
 884   8                                    break;
 885   8                                  }
 886   7                                }
 887   6                                else
 888   6                                {
 889   7                                  CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;  
 890   7                                }
 891   6                               break;
 892   6                             default: 
 893   6                                CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;  
 894   6                                break;
 895   6                           }
 896   5                           break;
 897   5                      case ReaderSignalON|BoxSignalON:
 898   5      
 899   5                            switch(CURRENT_GRANDSON_PROCESS)
 900   5                            {
 901   6                                case CURRENT_GRANDSON_PROCESS_step0:
 902   6                                    book_drop_Running_250times = 4*4;   //ÈëÊé´«ËÍ´øÕý´«2S
 903   6                                  prog_direct_running();
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 16  

 904   6                                  CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step1;
 905   6        
 906   6                                  break;
 907   6                                case CURRENT_GRANDSON_PROCESS_step1:
 908   6                                    if(book_drop_Running_250times)
 909   6                                  {
 910   7                                    if(BoxSensor_on_times == 0)
 911   7                                    {
 912   8                                      prog_book_drop_Return   = 1;
 913   8                                      RevolEnable       = 1;
 914   8                                        CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;
 915   8                                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step2;
 916   8      
 917   8                                      break;
 918   8                                    }
 919   7                                  }
 920   6                                  else
 921   6                                  {
 922   7                                    CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;
 923   7        
 924   7                                  }
 925   6                                    break;
 926   6                                default: 
 927   6                                    CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;  
 928   6                                    break;
 929   6                            }
 930   5                            break;
 931   5                      case ReaderSignalON|BoxSignalOFF:
 932   5                      case ReaderSignalOFF|BoxSignalOFF:  
 933   5      
 934   5                            prog_direct_running();                    
 935   5                      default:  CURRENT_GRANDSON_PROCESS = CURRENT_GRANDSON_PROCESS_step0;
 936   5        
 937   5                            break;
 938   5                    }
 939   4                  }
 940   3                  else
 941   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step2;
 942   3                  break;
 943   3      
 944   3              case  PROCESS_Command_book_drop_Step2:
 945   3                  while(BoxSensor==0)
 946   3                  {
 947   4                    prog_direct_running();
 948   4                  }
 949   3                  delay(10);
 950   3          //2014.8.1        Positive_Door_run();
 951   3      //            while(BoxSensor==0)
 952   3      //            {
 953   3      //              prog_direct_running();
 954   3      //            }
 955   3                  delay(200);               //Èç¹ûÊéµô²»ÏÂÈ¥£¬¾Í½«Ê±¼ä¼Ó³¤
 956   3                  delay(200);             //ÔÝÊ±È¡ÏûÑÓÊ±        
 957   3                  delay(200);
 958   3                  delay(200);
 959   3                  delay(200);
 960   3                  conveyor_run = 1;       //Í£Ö¹Á÷Ë®Ïß
 961   3                  door_NErunning_250times = 4*4;
 962   3                  prog_stop_running();
 963   3                //  delay_200msx(7);   //ÑÓ³Ù1.4ÃëÔÙÉÏ±¨ÈëÏä³É¹¦   Èç¹û²»ºÏÊÊÔÙÈ¥µô
 964   3            //      Positive_Door_run();
 965   3                  send_string_com(init_report_s141);     //ÉÏ±¨ÈëÏä³É¹¦
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 17  

 966   3                  send_string_com(init_report_s141);
 967   3                  send_string_com(init_report_s141);
 968   3            //      Positive_Door_run();     //2014.8.1
 969   3      //            while(CloseStopDoorRun != 0)//&&(door_NErunning_250times))             //2013.12.16 ||->&&
 970   3      //              {
 971   3      //                Positive_Door_run();  
 972   3      //            }
 973   3      //            Stop_Door_run();
 974   3      //            send_string_com(init_report_s9);           //ÉÏ±¨¿ªÃÅµ½Î»    
 975   3                  if(RevolEnable == 1)
 976   3                  {
 977   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step3;  //»Ø¹ö´¦Àí£¬Çø±ðÓëÍËÊé´¦Àí
 978   4                  }
 979   3                  else
 980   3                      CURRENT_FATHER_PROCESS=PROCESS_Command_book_in;
 981   3                  CURRENT_SON_PROCESS=PROCESS_Command_book_in_Step0;
 982   3      
 983   3                  //CURRENT_SON_PROCESS = PROCESS_Command_book_drop_End;
 984   3                  break;
 985   3              /*ÈëÊé»Ø¹ö´¦*/
 986   3              case  PROCESS_Command_book_drop_Step3:
 987   3                  book_drop_Running_250times = 4*5;             //ÍËÊé´«ËÍ´øÕý´«5S
 988   3                  prog_Reverse_running();
 989   3                  //Light_red_on();
 990   3                  door_NErunning_250times = 4*2;
 991   3      //            Negative_Door_run();
 992   3      //            if(OpenStopDoorRun == 0)//||!door_NErunning_250times)            //ÃÅµ½Î»Í£Ö¹9.22
 993   3      //              {
 994   3      //                  Stop_Door_run();
 995   3      //              send_string_com(init_report_s11);                 //ÉÏ±¨¹ØÃÅµ½Î»
 996   3      //            }
 997   3      //            else if(door_NErunning_250times==0)
 998   3      //            {
 999   3      //              Stop_Door_run();
1000   3      //              send_string_com(init_report_s12);                 //ÉÏ±¨¹ØÃÅ³¬Ê±
1001   3      //            }
1002   3                  send_string_com(init_report_s11);                 //ÉÏ±¨¹ØÃÅµ½Î»
1003   3                  ReadSensor_on_times = 0;
1004   3                  CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step4;  
1005   3                  break;
1006   3              case  PROCESS_Command_book_drop_Step4:
1007   3                  if(book_drop_Running_250times)  
1008   3                  {
1009   4                    if(ReadSensor_on_times  >= 10)                  //¼ì²é¶Á¿¨Ç°¹âµçÓÐÐ§ÐÅºÅ10msÂË²¨
1010   4                    {
1011   5                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step5;  
1012   5                    }     
1013   4                  }
1014   3                  else
1015   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step5;  
1016   3                    break;
1017   3              case  PROCESS_Command_book_drop_Step5:
1018   3                  book_drop_Running_250times_bake = book_drop_Running_250times;
1019   3                  if(book_drop_Running_250times > 0)              //Èç¹ûÊéÍËµ½¶Á¿¨Ç°¹â£¬Ôò¼ÌÐø1sÑÓÊ±              book_drop_Running_
             -250times = 2;              //ÍËÊéÑÓÊ±Ê±¼ä500ºÁÃë
1020   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step6;
1021   3                  break;
1022   3              case  PROCESS_Command_book_drop_Step6:
1023   3                    if(!book_drop_Running_250times)
1024   3                    {
1025   4                    prog_stop_running();    
1026   4                    QuerySysDeviceState();
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 18  

1027   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step7;
1028   4                    }
1029   3                   break;
1030   3              case  PROCESS_Command_book_drop_Step7:
1031   3                    if(!ReadSensor_on_times)
1032   3                    {
1033   4                    prog_Reverse_running();
1034   4                    //Light_red_on();
1035   4                    door_NErunning_250times = 4*3;
1036   4                    Negative_Door_run();
1037   4                    if(OpenStopDoorRun == 0)//||!door_NErunning_250times)            //door 9.22
1038   4                      {
1039   5                         Stop_Door_run();
1040   5                       send_string_com(init_report_s11);        //ÉÏ±¨¹ØÃÅ½áÊø
1041   5                    }
1042   4                    else if(door_NErunning_250times==0)
1043   4                    {
1044   5                       Stop_Door_run();
1045   5                       send_string_com(init_report_s12);       //ÉÏ±¨¹ØÃÅ³¬Ê±
1046   5                    }   
1047   4                    ReadSensor_on_times = 0;
1048   4                    book_drop_Running_250times = book_drop_Running_250times_bake;
1049   4                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step8;
1050   4                    } 
1051   3                  break;
1052   3              case  PROCESS_Command_book_drop_Step8:
1053   3                  if(book_drop_Running_250times)  
1054   3                  {
1055   4                    if(ReadSensor_on_times  >= 10)              //¼ì²é¶Á¿¨Ç°¹âµçÓÐÐ§ÐÅºÅ10msÂË²¨
1056   4                    {
1057   5                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step9;  
1058   5                    }     
1059   4                  }
1060   3                  else
1061   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_Step9;          
1062   3                  break;
1063   3              case  PROCESS_Command_book_drop_Step9:
1064   3                    if(book_drop_Running_250times > 0)              //Èç¹ûÊéÍËµ½¶Á¿¨Ç°¹â£¬Ôò¼ÌÐø1sÑÓÊ±
1065   3                      book_drop_Running_250times = 2;               //ÍËÊéÑÓÊ±Ê±¼ä500ºÁÃë
1066   3                    CURRENT_SON_PROCESS = PROCESS_Command_book_drop_StepA;  
1067   3                    break;
1068   3              case  PROCESS_Command_book_drop_StepA:
1069   3                    if(book_drop_Running_250times)
1070   3                    {
1071   4                      break;
1072   4                    }
1073   3                    else
1074   3                      CURRENT_SON_PROCESS = PROCESS_Command_book_drop_End;          
1075   3                    prog_stop_running();
1076   3              case  PROCESS_Command_book_drop_End:
1077   3                    SysModle = SystermIdle;                       
1078   3              default:CURRENT_FATHER_PROCESS =  PROCESS_Command_Idle;     //ÈëÏäÍê±Ï£¬ÉèÖÃÏµÍ³Îª¿ÕÏÐ×´Ì¬
1079   3                  door_NErunning_250times = 4*2;
1080   3      //            Negative_Door_run();
1081   3      //            if(OpenStopDoorRun == 0||!door_NErunning_250times)             //door 9.22
1082   3      //              {
1083   3      //                Stop_Door_run();
1084   3      //              }   
1085   3                  break;
1086   3            }
1087   2            break;
1088   2            
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 19  

1089   2            #endregion
*** WARNING C315 IN LINE 1089 OF equipment.c: unknown #directive 'endregion'
1090   2          
1091   2          case  PROCESS_Command_Idle:
1092   2          //    conveyor_run = 1;
1093   2      //        if(OpenStopDoorRun == 0)//||!door_NErunning_250times)            //door 9.22
1094   2      //          {
1095   2      //          Stop_Door_run();
1096   2      //    //      send_string_com(init_report_s11);
1097   2      //        }
1098   2      //        else if(door_NErunning_250times==0)
1099   2      //        {
1100   2      //          Stop_Door_run();
1101   2      //    //      send_string_com(init_report_s12);
1102   2      //        }
1103   2          default: break;
1104   2        }
1105   1      }
1106          void ReceiveDateProcess(void)
1107          {
1108   1        uchar   i,i_BSP = CE_OK;
1109   1        uint crcTemp1,crcTemp2;
1110   1        if(RecvState == RecvStateEnd)
1111   1        {
1112   2          system_waiting_250times=4*60;    //2014.8.12 ÏµÍ³¿ÕÏÐµÈ´ýÊ±¼ä
1113   2          for(i=0;i<0x0B;i++)                                         //×ªÒÆÊý¾Ý£¬±ÜÃâÊý¾Ý´¦Àí¹ý³ÌÖÐ·¢ÉúÊý¾ÝÅö×²
1114   2          {                                                                    
1115   3            InBuff[i]=SerialInbuff[i];                                //½«½ÓÊÕ»º³åÇøµÄÊý¾Ý×ªÒÆ±¸·Ý   
1116   3            SerialInbuff[i]=0;                                        //½ÓÊÕ»º³åÇøÇåÁã                              
             -                                 
1117   3          }
1118   2          RecvState=RecvStateIdle;                      //Êý¾Ý´¦ÀíÍê±Ï£¬¿ÉÒÔ½ÓÊÕÐÂÃüÁî
1119   2          if((InBuff[10]!=0x03)||(InBuff[1]!=0x08))                   //changed by zhanglei 03-26
1120   2          {                                                               //ÅÐ¶ÏÊý¾ÝµÄ½áÎ²ºÍ³¤¶È                            
             -    
1121   3            i_BSP =  CE_NOCOMM;                                         //Í¨Ñ¶Êý¾Ý´íÎó£¨Í·,Î²,³¤¶È´í£©           
1122   3          }
1123   2          else
1124   2          { 
1125   3            crcbuf_In[0]=InBuff[2];                       //È¡ÃüÁîÂë
1126   3            crcbuf_In[1]=InBuff[3];                     //RSP
1127   3            crcbuf_In[2]=InBuff[4];                     //PARAMETER1 |
1128   3            crcbuf_In[3]=InBuff[5];                     //PARAMETER2 |   ²ÎÊý  
1129   3            crcbuf_In[4]=InBuff[6];                     //PARAMETER3 |
1130   3            crcbuf_In[5]=InBuff[7];                     //PARAMETER4 |
1131   3            EA=0;                             //CRC¼ÆËã¹ý³ÌÖÐ£¬¶ÌÔÝ½ûÖ¹ÖÐ¶Ï²úÉú         
1132   3            crcTemp1=CRC3(crcbuf_In, 6);                      //½«Ð£ÑéºóµÄÊý¾Ý´æÈë crcTemp1, crcbuf_In×÷Îªcrcbuf_In[6]Êý
             -×éµÄÊ×µØÖ·£¬»òÓÃ &(crcbuf_In[6])
1133   3            crcTemp2=InBuff[8];                               //crcÐ£ÑéÂëµÄ¸ß°ËÎ»    
1134   3            crcTemp2=crcTemp2<<8;                   //»ñÈ¡crcTemp2¸ß8Î»
1135   3            crcTemp2|=InBuff[9];                              //»ñÈ¡crcTemp2µÍ8Î»£¬ºÏ²¢³É16Î»
1136   3            EA=1;                                       //´ò¿ªÖÐ¶Ï 
1137   3            if(crcTemp1!=crcTemp2)                            //½«Ð£ÑéºóµÄÊý¾ÝºÍ½ÓÊÕµ½µÄÐ£ÑéÂë×÷±È½Ï
1138   3            {                                        
1139   4              i_BSP =  CE_CHECKERROR;                                 //Ð£ÑéÂë´í
1140   4            }
1141   3          }
1142   2          if(i_BSP == CE_OK)
1143   2          {
1144   3            //RD_command = InBuff[2];                 //Ö÷ÃüÁî
1145   3            //RD_command_Hpara1  = InBuff[4];                 //»ñÈ¡ÃüÁîÐ¯´øµÄ²ÎÊýHPARA_H 
1146   3            //RD_command_Hpara2  = InBuff[5] ;                //»ñÈ¡ÃüÁîÐ¯´øµÄ²ÎÊýHPARA_L
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 20  

1147   3            //RD_command_Lpara1  = InBuff[6] ;                //»ñÈ¡ÃüÁîÐ¯´øµÄ²ÎÊýLPARA_H
1148   3            //RD_command_Lpara2  = InBuff[7] ;                //»ñÈ¡ÃüÁîÐ¯´øµÄ²ÎÊýLPARA_L
1149   3            host_command(InBuff[2],InBuff[4],InBuff[5]);//ÃüÁî´¦Àí,¾¡Á¿±ÜÃâÓÃÈ«¾Ö±äÁ¿£¬²ÉÓÃÐÎ²Îµ¼Èë
1150   3          }
1151   2          else
1152   2          {
1153   3            send_string_err(i_BSP);                   //·¢ËÍÍ¨Ñ¶´íÎóÐÅÏ¢
1154   3          }
1155   2        } 
1156   1      //   RD_command = Command_Idle;                     //Çå¿ÕÃüÁî¼Ä´æÆ÷
1157   1      //  RD_command_Hpara1  = 0; 
1158   1      //  RD_command_Hpara2  = 0 ;
1159   1      //  RD_command_Lpara1  = 0 ; 
1160   1      //  RD_command_Lpara2  = 0 ; 
1161   1        for(i=0;i<0x0B;i++)                                           //×ªÒÆÊý¾Ý£¬±ÜÃâÊý¾Ý´¦Àí¹ý³ÌÖÐÐÂµÄÊý¾Ý
1162   1        {                                                                    
1163   2          InBuff[i]=0;                                          //½«Êý¾Ý±¸·ÝÇå¿ÕÎª0                                     
             -                           
1164   2        }
1165   1      } 
1166          
1167          void host_command(unsigned char RD_command,unsigned char RD_command_Hpara1,unsigned char RD_command_Hpara2
             -)
1168          {
1169   1        
1170   1        switch(RD_command)
1171   1        {
1172   2          case Command_reset: 
1173   2            { 
1174   3            //  if(CURRENT_FATHER_PROCESS !=  PROCESS_Command_Idle)
1175   3            //    send_string_err(CE_EXECUTE); 
1176   3            //  else
1177   3            //  { 
1178   3                CURRENT_FATHER_PROCESS  = PROCESS_Command_reset ; 
1179   3                CURRENT_SON_PROCESS = PROCESS_Command_reset_Step0;
1180   3                CURRENT_GRANDSON_PROCESS= CURRENT_GRANDSON_PROCESS_step0;
1181   3                TCounter250           = 0;  //250ºÁÃë¼ÆÊýÆ÷
1182   3      //          TCounter8             = 0;  //8ºÁÃë¼ÆÊýÆ÷
1183   3      //          Time8ms_flag          = 0;  //8ºÁÃë±êÖ¾
1184   3                Time250ms_flag          = 0;    //250Áë?          TCounter250           = 0;
1185   3      //          TCounter8           = 0;
1186   3      //          Time8ms_flag          = 0;
1187   3      //          Time250ms_flag          = 0;
1188   3                EntrySensor_on_times        = 0;
1189   3                ReadSensor_on_times         = 0;
1190   3                ReadSensor_on_timeout_250times  = 0;
1191   3                BoxSensor_on_times        = 0;
1192   3                prog_reset_250times       = 0;
1193   3                book_in_Running_250times      = 0;
1194   3                book_out_Running_250times     = 0;
1195   3            //    book_out_Running_250times_bake  = 0;
1196   3                book_drop_Running_250times    = 0;
1197   3                book_drop_Running_250times_bake = 0;
1198   3            //    book_stop_running_250tims     = 0;      
1199   3              }               
1200   2          //  }
1201   2            break;  
1202   2            
1203   2          case Command_book_action:                         //´«ËÍ´øÔËÐÐÃüÁî£¬¸ù¾Ý²ÎÊý·Ö±ð¾ßÌåµÄÏ¸·Ö¶¯×÷
1204   2          { 
1205   3            if((RD_command_Hpara1 == 0x02)&&(RD_command_Hpara2 == 0x02))  /* ½áÊø */
1206   3            {
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 21  

1207   4                if((BoxSensor==1)&&(SysState==0))
1208   4              {
1209   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_End;
1210   5                  CURRENT_SON_PROCESS =  PROCESS_Command_End_Step0;
1211   5              }
1212   4              else
1213   4                send_string_err(CE_EXECUTE);                
1214   4            }
1215   3            else if((CURRENT_FATHER_PROCESS != PROCESS_Command_Idle))
1216   3              send_string_err(CE_EXECUTE); 
1217   3            else
1218   3            { 
1219   4              if((RD_command_Hpara1 == 0x01)&&(RD_command_Hpara2 == 0x01))    /* ÈëÊé */        
1220   4              { 
1221   5                CURRENT_FATHER_PROCESS  =   PROCESS_Command_book_in ;
1222   5                CURRENT_SON_PROCESS =   PROCESS_Command_book_in_Step0;            
1223   5              }
1224   4              else if((RD_command_Hpara1 == 0x01)&&(RD_command_Hpara2 == 0x02)) /* ÍËÊé */
1225   4              {
1226   5                CURRENT_FATHER_PROCESS  =  PROCESS_Command_book_out   ;
1227   5                CURRENT_SON_PROCESS =  PROCESS_Command_book_out_Step0;                  
1228   5              }
1229   4              else if((RD_command_Hpara1 == 0x02)&&(RD_command_Hpara2 == 0x01))   /* ÈëÏä */
1230   4              {
1231   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_book_drop ;
1232   5                CURRENT_SON_PROCESS =  PROCESS_Command_book_drop_Step0; 
1233   5                CURRENT_GRANDSON_PROCESS=  CURRENT_GRANDSON_PROCESS_step0;            
1234   5              }
1235   4              else if((RD_command_Hpara1 == 0x03)&&(RD_command_Hpara2 == 0x01))   /* ´«ËÍ´øÕý×ª */
1236   4              {
1237   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_prog_direct ;
1238   5                CURRENT_SON_PROCESS =  PROCESS_Command_prog_direct_Step0;             
1239   5              }
1240   4              else if((RD_command_Hpara1 == 0x03)&&(RD_command_Hpara2 == 0x02))   /* ´«ËÍ´ø·´×ª */
1241   4              {
1242   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_prog_reverse ;
1243   5                CURRENT_SON_PROCESS =  PROCESS_Command_prog_reverse_Step0;              
1244   5              }
1245   4              else if((RD_command_Hpara1 == 0x03)&&(RD_command_Hpara2 == 0x03))   /* ´«ËÍ´øÍ£Ö¹ */
1246   4              {
1247   5                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_prog_stop ;
1248   5                CURRENT_SON_PROCESS =  PROCESS_Command_prog_stop_Step0;             
1249   5              }
1250   4              /*else if((RD_command_Hpara1 == 0x02)&&(RD_command_Hpara2 == 0x02))   /* ½áÊø */
1251   4              /*{
1252   4                  CURRENT_FATHER_PROCESS  =  PROCESS_Command_End;
1253   4                CURRENT_SON_PROCESS   =  PROCESS_Command_End_Step0;         
1254   4              }*/
1255   4              else
1256   4                send_string_err(CE_BADPARAM);                   //·¢ËÍÃüÁî²ÎÊý´íÎó
1257   4            }
1258   3            break;
1259   3          }
1260   2          //////////////////////////////////////////////////////////////////////
1261   2          case Command_cleck_state:   
1262   2              prog_cleck_state();     /* ¼ì²é¹âÄ»×´Ì¬²¢·¢ËÍ¸øPC*/
1263   2              break;
1264   2          case Command_check_vison:   
1265   2              prog_check_vison();     /* ²éÑ¯°æ±¾ºÅ*/
1266   2              break;
1267   2          default:   
1268   2              send_string_err(CE_BADCOMMAND);                   //·¢ËÍÃüÁî´íÎó
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 22  

1269   2              break;
1270   2        }
1271   1      }
1272          // prog_check_vison--------------------------------------
1273          void prog_cleck_state()
1274          {
1275   1        char i_Senser,j_Senser; 
1276   1        send_string_com(Re_che_state);
1277   1                                      
1278   1        i_Senser = P0;              //È¡P0.0~P0.3µÄ×´Ì¬
1279   1        i_Senser &= 0x0F;
1280   1        i_Senser = 0x0F - i_Senser;
1281   1        j_Senser = P2;              //È¡P2.4~P2.7µÄ×´Ì¬
1282   1      //  j_Senser = ~j_Senser;
1283   1        j_Senser &= 0xE0;
1284   1        if(j_Senser == 0xE0)
1285   1        {
1286   2          delay_1msx(80);             //·ÀÎó±¨´¦Àí ÈçÎÞÕÚµ² ÔÙ¼ì²âÒ»´Î  80mmÐèÒª100ms
1287   2          i_Senser = P0;              //È¡P0.0~P0.3µÄ×´Ì¬
1288   2            i_Senser &= 0x0F;
1289   2            i_Senser = 0x0F - i_Senser;
1290   2            j_Senser = P2;              //È¡P2.4~P2.7µÄ×´Ì¬
1291   2      //      j_Senser = ~j_Senser;
1292   2            j_Senser &= 0xE0;
1293   2        }
1294   1        j_Senser = 0xE0 - j_Senser;                           //Í¨Ñ¶·µ»ØÎÞÐèÑÓÊ±
1295   1        i_Senser = (j_Senser | i_Senser);
1296   1        prog_check_state_report(i_Senser);
1297   1          
1298   1      }
1299          
1300          void prog_check_state_report(unsigned char i_Senser)                  //²éÑ¯Ö¸Áî·µ»Ø¹âÄ»×´Ì¬
1301          {
1302   1        unsigned char *i_str;
1303   1        if(i_Senser==0x00)
1304   1        {
1305   2          Re_data_erro[4] = i_Senser;
1306   2          Re_data_erro[5] = 0x01;
1307   2          i_str = Re_data_erro;
1308   2        }
1309   1        else
1310   1        {
1311   2            Re_data_erro[4] = i_Senser;
1312   2          Re_data_erro[5] = 0x00;
1313   2            i_str = Re_data_erro;
1314   2        }
1315   1      
1316   1        send_string_com(i_str); 
1317   1      }
1318          void prog_init_report(unsigned char i_Senser)           //Ö÷¶¯ÉÏ±¨¹âÄ»×´Ì¬
1319          {
1320   1        unsigned char *i_str;
1321   1        switch(i_Senser&0x0F)
1322   1        {
1323   2          case  0x00: i_str = init_report_s0   ;break;
1324   2          case  0x01: i_str = init_report_s1   ;break;
1325   2          case  0x02: i_str = init_report_s2   ;break;
1326   2          case  0x03: i_str = init_report_s3   ;break;
1327   2          case  0x04: i_str = init_report_s4   ;break;
1328   2          case  0x05: i_str = init_report_s5   ;break;
1329   2          case  0x06: i_str = init_report_s6   ;break;
1330   2          case  0x07: i_str = init_report_s7   ;break;
C51 COMPILER V9.57.0.0   EQUIPMENT                                                         06/03/2023 17:44:18 PAGE 23  

1331   2          case  0x08: i_str = init_report_s8   ;break;
1332   2      //    case  0x09: i_str = init_report_s9   ;break;
1333   2      //    case  0x0A: i_str = init_report_s10  ;break;
1334   2      //    case  0x0B: i_str = init_report_s11  ;break;
1335   2      //    case  0x0C: i_str = init_report_s12  ;break;
1336   2      //    case  0x0D: i_str = init_report_s13  ;break;
1337   2      //    case  0x0E: i_str = init_report_s14  ;break;
1338   2      //    case  0x0F: i_str = init_report_s15  ;break;
1339   2          default : i_str = init_report_s30  ;break;
1340   2        }
1341   1        send_string_com(i_str); 
1342   1      }
1343          
1344          // prog_check_vison--------------------------------------
1345          void prog_check_vison()
1346          {
1347   1        ;//send_string_com(Re_check_vison);
1348   1      }
1349          // initiative_report--------------------------------------
1350          void QuerySysDeviceState(void)              //Éè±¸×Ô¶¯²éÑ¯Éè±¸×´Ì¬²¢ÉÏ±¨
1351          {             
1352   1        uchar temp;                       //¶¨ÒåÒ»¸öÁÙÊ±±äÁ¿ 
1353   1          
1354   1        temp  = SysDeviceState&0x0F;                //±¸·ÝÉÏ´Î´«¸ÐÆ÷µÄ×´Ì¬µ½temp
1355   1        
1356   1        SysDeviceState=0X00;                    //µ±Ç°×´Ì¬ÇåÁã£¬ÒÔ±ãÖØÐÂ²éÑ¯×´Ì¬
1357   1        
1358   1        if(EntrySensor_on_times >= EnterSensor_signal_on)   //ÅÐ¶ÏÈë¿Ú¹âÄ»ÓÐÎïÌå
1359   1           SysDeviceState = SysDeviceState|EnterSensorFlag; //»ñÈ¡Èë¿Ú¹âÄ»×´Ì¬
1360   1        
1361   1        if(ReadSensor_on_times  >= ReadSensor_signal_on)    //ÅÐ¶Ï¶Á¿¨Æ÷Ç°Ò»µÀ¹âÄ»
1362   1           SysDeviceState = SysDeviceState|ReadSensorFlag;  //»ñÈ¡¶Á¿¨Æ÷Ç°×´Ì¬
1363   1        
1364   1        if(BoxSensor_on_times   >= BoxSensor_signal_on)     //ÅÐ¶ÏÈëÏä¹âÄ»¼ì²â
1365   1           SysDeviceState = SysDeviceState|BoxSensorFlag; //»ñÈ¡ÈëÏä¹âÄ»×´Ì¬
1366   1      
1367   1          if(temp != (SysDeviceState&0x0F))                 //×îÖÕ±È½Ïµ±Ç°¹âÄ»×´Ì¬ÓëÉÏ´Î¹âÄ»×´Ì¬ÊÇ·ñ·¢Éú±ä»¯ 
1368   1          {  
1369   2          prog_init_report(SysDeviceState&0x0F);      //ÓÐ±ä»¯£¬ÉÏ±¨µ±Ç°×´Ì¬ 
1370   2          }                                       //ÎÞ±ä»¯£¬×´Ì¬²»ÉÏ±¨                                                
             -      
1371   1      } 
1372          
1373          void delay(uint num)
1374          {
1375   1       uchar i;
1376   1       while(num--)
1377   1       for(i=110;i>0;i--);
1378   1      }
1379            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2674    ----
   CONSTANT SIZE    =    451    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  16 WARNING(S),  0 ERROR(S)
